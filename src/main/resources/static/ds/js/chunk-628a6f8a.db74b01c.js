(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-628a6f8a"],{"0833":function(t,e,r){},"14d9":function(t,e,r){"use strict";var a=r("23e7"),o=r("7b0b"),s=r("07fa"),l=r("3a34"),n=r("3511"),i=r("d039"),u=i((function(){return 4294967297!==[].push.call({length:4294967296},1)})),p=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(t){return t instanceof TypeError}},c=u||!p();a({target:"Array",proto:!0,arity:1,forced:c},{push:function(t){var e=o(this),r=s(e),a=arguments.length;n(r+a);for(var i=0;i<a;i++)e[r]=arguments[i],r++;return l(e,r),r}})},3511:function(t,e){var r=TypeError,a=9007199254740991;t.exports=function(t){if(t>a)throw r("Maximum allowed index exceeded");return t}},"3a34":function(t,e,r){"use strict";var a=r("83ab"),o=r("e8b5"),s=TypeError,l=Object.getOwnPropertyDescriptor,n=a&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();t.exports=n?function(t,e){if(o(t)&&!l(t,"length").writable)throw s("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e}},"6b79":function(t,e,r){"use strict";r.d(e,"a",(function(){return a}));const a={methods:{formatTime(t){let e="-";try{e=new Date(1e3*t);var r=e.getFullYear(),a=e.getMonth()+1,o=e.getDate(),s=e.getHours(),l=e.getMinutes(),n=e.getSeconds(),i=`${r}-${a}-${o} ${s}:${l}:${n}`;return i}catch(u){console.log(u)}return e}}}},a3b0:function(t,e,r){"use strict";r("c829")},ae8d:function(t,e,r){"use strict";var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"card"},[t.title?e("div",{staticClass:"card-head"},[t._v(" "+t._s(t.title)+" "),e("div",{staticStyle:{float:"right"}},[t._t("op")],2)]):t._e(),t._t("default")],2)},o=[],s={name:"Card",props:{title:{type:String,default:""}}},l=s,n=(r("b581"),r("2877")),i=Object(n["a"])(l,a,o,!1,null,"88a16ad0",null);e["a"]=i.exports},b581:function(t,e,r){"use strict";r("f619")},c829:function(t,e,r){},db8d:function(t,e,r){"use strict";r("0833")},e8b5:function(t,e,r){var a=r("c6b6");t.exports=Array.isArray||function(t){return"Array"==a(t)}},f619:function(t,e,r){},fec0:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t._self._c;return e("transition-group",{staticClass:"grid-rows",attrs:{tag:"div",appear:""},on:{"before-enter":t.beforeEnter,enter:t.animEnter}},[e("Mine",{key:"0",attrs:{"data-index":"0"}}),e("Applications",{key:"2",attrs:{"data-index":"0.3"}}),e("Approvals",{key:"1",attrs:{"data-index":"0.5"}}),e("History",{key:"3",attrs:{"data-index":"0.6"}})],1)},o=[],s=function(){var t=this,e=t._self._c;return e("Card",{attrs:{title:"我的属性"},scopedSlots:t._u([{key:"op",fn:function(){return[e("el-input",{attrs:{size:"medium",placeholder:"请输入要声明的属性"},model:{value:t.newAttr,callback:function(e){t.newAttr=e},expression:"newAttr"}},[e("el-button",{attrs:{slot:"append"},on:{click:t.generateAttr},slot:"append"},[t._v("声明新属性")])],1)]},proxy:!0}])},[t.APKMap?e("div",[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.getAttributes(t.APKMap)}},[e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"name",label:"属性名"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"value",label:"属性公钥"}})],1)],1):e("el-empty",{attrs:{"image-size":100,description:"还没有属性"}})],1)},l=[],n=(r("14d9"),r("ae8d")),i=r("07a4"),u=r("63e0"),p={name:"Mine",components:{Card:n["a"]},computed:{...i["a"].mapUser(["APKMap"])},data(){return{newAttr:""}},methods:{getAttributes(t){let e=[];for(let r of Object.keys(t))e.push({name:r,value:t[r].Gy});return e},generateAttr(){const{name:t}=i["a"].properties(["name","password"]),e=`${t}:${this.newAttr}`;u["a"].generate({name:t,attr:e}).then(()=>{this.$message({message:"创建成功",duration:2e3,type:"success"})}).catch(t=>{this.$message({message:t.message,type:"error"})})}}},c=p,m=r("2877"),d=Object(m["a"])(c,s,l,!1,null,null,null),f=d.exports,b=function(){var t=this,e=t._self._c;return e("Card",{attrs:{title:"历史记录"}},[t.records.length?e("div",[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.records}},[e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"uid",label:"当前用户"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"fromUid",label:"操作用户"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"attrName",label:"属性名称"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"operation",label:"操作"}}),e("el-table-column",{attrs:{sortable:"",prop:"timeStamp",label:"操作时间"}})],1)],1):e("el-empty",{attrs:{"image-size":100,description:"还没有记录"}})],1)},h=[],g=r("6b79"),y=r("f8ce"),v={name:"History",components:{Card:n["a"]},mixins:[g["a"]],data(){return{records:[]}},methods:{},mounted(){const t=i["a"].userName();y["a"].history(t).then(t=>{this.records=t})}},w=v,k=Object(m["a"])(w,b,h,!1,null,null,null),_=k.exports,A=function(){var t=this,e=t._self._c;return e("div",[e("Card",{attrs:{title:"属性审批"}},[t.attributes.length?e("div",[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.attributes}},[e("el-table-column",{attrs:{prop:"isPublic",label:"",width:"50"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.isPublic?"公开":"私有")+" ")]}}],null,!1,2581177575)}),e("el-table-column",{attrs:{prop:"status",label:"类型",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.applyType)+" ")]}}],null,!1,4286698161)}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"attrName",label:"属性名"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"fromUid",label:"申请人"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"remark",label:"申请备注"}}),e("el-table-column",{attrs:{label:"操作",width:"250"},scopedSlots:t._u([{key:"default",fn:function(r){return[e("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(e){return t.revoke(r.row)}}},[t._v(" 撤销 ")]),e("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(e){return t.agree(r.row,!0)}}},[t._v(" 同意 ")]),e("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.agree(r.row,!1)}}},[t._v(" 拒绝 ")])]}}],null,!1,2738409261)}),e("el-table-column",{attrs:{prop:"status",label:"状态",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(r){return[e("el-tag",{attrs:{type:t.statusTypes[r.row.status],size:"small"}},[t._v(" "+t._s(r.row.status)+" ")])]}}],null,!1,3402781693)})],1)],1):e("el-empty",{attrs:{"image-size":100,description:"暂无待审批的属性"}})],1),e("el-dialog",{attrs:{title:"属性审批",visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[e("el-form",{attrs:{model:t.form,"label-width":"80px"}},[e("el-form-item",{attrs:{label:"备注"}},[e("el-input",{attrs:{type:"textarea"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.approval}},[t._v("确 定")])],1)],1)],1)},x=[],$={name:"Approvals",components:{Card:n["a"]},mounted(){const{OPKMap:t,name:e}=i["a"].properties(["OPKMap","name"]),r=[{to:e,role:0}];Object.keys(t).map(t=>{r.push({to:t,role:1})});const a="ALL";this.queryWithStatus(r,a).then(t=>{this.attributes=t})},data(){return{attributes:[],form:{remark:""},params:{},dialogFormVisible:!1,statusTypes:{SUCCESS:"success",FAIL:"danger",PENDING:"pending",REVOKE:"revoke"}}},methods:{queryWithStatus(t,e){let r=[];return new Promise((a,o)=>{Promise.all(t.map(({to:t,role:r})=>y["a"].applications({to:t,role:r,status:e}))).then(t=>{t.forEach(t=>{r=r.concat(t)}),a(r)}).catch(o)})},agree(t,e){const r=i["a"].userName(),{attrName:a,fromUid:o}=t;this.params={to:o,agree:e,attr:a,user:r},this.dialogFormVisible=!0},approval(){y["a"].approval({...this.params,...this.form}).then(()=>{this.$message({message:"审批成功",duration:2e3,type:"success"})}).catch(t=>{this.$message({message:t.message,duration:2e3,type:"error"})}).finally(()=>{this.dialogFormVisible=!1})},revoke(t){const e=i["a"].userName(),{attrName:r,fromUid:a}=t;y["a"].revoke({userName:e,toUserName:a,attrName:r}).then(()=>{this.$message({message:"撤销成功",duration:2e3,type:"success"})}).catch(t=>{this.$message({message:t.message,duration:2e3,type:"error"})})}}},S=$,F=Object(m["a"])(S,A,x,!1,null,null,null),C=F.exports,O=function(){var t=this,e=t._self._c;return e("div",[e("Card",{attrs:{title:"属性授权"},scopedSlots:t._u([{key:"op",fn:function(){return[e("el-button",{attrs:{slot:"append",size:"small"},on:{click:t.syncApplications},slot:"append"},[t._v(" 同步属性 ")]),e("el-button",{attrs:{slot:"append",size:"small",type:"primary"},on:{click:function(e){t.dialogFormVisible=!0}},slot:"append"},[t._v(" 申请属性 ")])]},proxy:!0}])},[t.appliedAttrMap?e("div",[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.formatAttributes(t.appliedAttrMap)}},[e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"name",label:"属性名"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"value",label:"属性公钥"}})],1)],1):e("el-empty",{attrs:{"image-size":100,description:"没有正在申请的属性"}})],1),e("el-dialog",{attrs:{title:"申请属性",visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[e("el-form",{ref:"applyForm",attrs:{rules:t.applyRules,model:t.form,"label-width":"80px"}},[e("el-form-item",{attrs:{prop:"attr",label:"属性名"}},[e("el-input",{model:{value:t.form.attr,callback:function(e){t.$set(t.form,"attr",e)},expression:"form.attr"}})],1),e("el-form-item",{attrs:{label:"属性类型"}},[e("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入用户或组织名"},model:{value:t.form.belongs,callback:function(e){t.$set(t.form,"belongs",e)},expression:"form.belongs"}},[e("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:t.form.role,callback:function(e){t.$set(t.form,"role",e)},expression:"form.role"}},[e("el-option",{attrs:{label:"用户属性",value:"to"}}),e("el-option",{attrs:{label:"组织属性",value:"org"}})],1)],1)],1),e("el-form-item",{attrs:{label:"备注"}},[e("el-input",{attrs:{type:"textarea"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.applyForAttr}},[t._v("确 定")])],1)],1)],1)},M=[],E={name:"Applications",components:{Card:n["a"]},computed:{...i["a"].mapUser(["appliedAttrMap"])},mounted(){},data(){return{attributes:[],statusTypes:{"已通过":"success","被拒绝":"danger","未处理":"info"},dialogFormVisible:!1,form:{attr:"",to:"",org:"",belongs:"",role:"to",remark:""},applyRules:{attr:[{required:!0,trigger:"blur",message:"属性名不能为空"}]}}},methods:{formatAttributes(t){let e=[];for(let r of Object.keys(t))e.push({name:r,value:t[r]});return e},applyForAttr(){const{name:t}=i["a"].properties(["name"]);t&&this.$refs.applyForm.validate(e=>{if(!e)return;let r={to:"",org:""};const{remark:a,role:o,belongs:s}=this.form;r[o]=s;const l=`${s}:${this.form.attr}`;y["a"].apply({attr:l,name:t,remark:a,...r}).then(()=>{this.$message({message:"申请成功",duration:2e3,type:"success"})}).catch(t=>{this.$message({message:t.message,type:"error"})}).finally(()=>{this.dialogFormVisible=!1})})},syncApplications(){u["a"].sync().then(()=>{this.$message({message:"同步成功",duration:2e3,type:"success"})}).catch(t=>{this.$message({message:t.message,type:"error"})})}}},P=E,V=(r("db8d"),Object(m["a"])(P,O,M,!1,null,null,null)),j=V.exports,N={name:"Attributes",components:{Mine:f,History:_,Approvals:C,Applications:j},data(){return{attributes:[]}},methods:{beforeEnter:function(t){t.dataset.index>-1&&(t.style.opacity=.5,t.style.transform="translateX(30px)")},animEnter:function(t,e){var r=250*t.dataset.index;setTimeout((function(){t.style="",e()}),r)}}},z=N,T=(r("a3b0"),Object(m["a"])(z,a,o,!1,null,"6ffe5a46",null));e["default"]=T.exports}}]);
//# sourceMappingURL=chunk-628a6f8a.db74b01c.js.map