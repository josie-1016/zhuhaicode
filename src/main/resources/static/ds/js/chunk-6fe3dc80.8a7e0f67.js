(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6fe3dc80"],{a969:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("div",{staticClass:"wer"},[t("div",{staticClass:"wer-left"},[t("el-input",{attrs:{placeholder:"设备名称"},model:{value:e.searchInput,callback:function(t){e.searchInput=t},expression:"searchInput"}})],1),t("div",[t("el-button",{on:{click:e.searchCert}},[e._v(" 查询证书 ")]),t("el-button",{attrs:{type:"success"},on:{click:function(t){e.applyFormVisible=!0}}},[e._v(" 证书申请 ")])],1)]),t("el-table",{attrs:{data:e.certificates,"empty-text":e.emptyText}},[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"设备名称",prop:"ABSUID"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"证书序号",prop:"serialNumber"}}),t("el-table-column",{attrs:{label:"操作",align:"right"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini",type:"warning",plain:""},on:{click:function(t){return e.revoke(s)}}},[e._v(" 撤销证书 ")]),t("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.detailInfo(s.row)}}},[e._v(" 详细信息 ")])]}}])})],1),t("el-dialog",{attrs:{title:"详细信息",visible:e.detailVisible},on:{"update:visible":function(t){e.detailVisible=t}}},[t("el-descriptions",{attrs:{column:1}},[t("el-descriptions-item",{attrs:{label:"版本"}},[e._v(e._s(e.detail.version))]),t("el-descriptions-item",{attrs:{label:"设备"}},[e._v(e._s(e.detail.ABSUID)+" ")]),t("el-descriptions-item",{attrs:{label:"证书序号"}},[e._v(" "+e._s(e.detail.serialNumber)+" ")]),t("el-descriptions-item",{attrs:{label:"标签"}},[e._v(" "+e._s(e.detail.ABSAttribute)+" ")]),t("el-descriptions-item",{attrs:{label:"签名人"}},[e._v(e._s(e.detail.issuer))]),t("el-descriptions-item",{attrs:{label:"签名"}},[e._v(e._s(e.detail.signatureName))]),t("el-descriptions-item",{attrs:{label:"优先级"}},[e._v(e._s(e.detail.validityPeriod))])],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.detailVisible=!1}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"证书申请",visible:e.applyFormVisible},on:{"update:visible":function(t){e.applyFormVisible=t}}},[t("el-form",{ref:"applyForm",attrs:{rules:e.applyRules,model:e.applyCert,"label-width":"80px"}},[t("el-form-item",{attrs:{prop:"uid",label:"UID"}},[t("el-input",{model:{value:e.applyCert.uid,callback:function(t){e.$set(e.applyCert,"uid",t)},expression:"applyCert.uid"}})],1),t("el-form-item",{attrs:{prop:"attribute",label:"标签"}},[t("el-input",{model:{value:e.applyCert.attribute,callback:function(t){e.$set(e.applyCert,"attribute",t)},expression:"applyCert.attribute"}})],1),e.applyRes?t("div",[t("el-form-item",{attrs:{size:"mini",label:"版本"}},[e._v(e._s(e.applyRes.version))]),t("el-form-item",{attrs:{size:"mini",label:"设备"}},[e._v(e._s(e.applyRes.ABSUID)+" ")]),t("el-form-item",{attrs:{size:"mini",label:"证书序号"}},[e._v(" "+e._s(e.applyRes.serialNumber)+" ")]),t("el-form-item",{attrs:{size:"mini",label:"标签"}},[e._v(" "+e._s(e.applyRes.ABSAttribute)+" ")]),t("el-form-item",{attrs:{size:"mini",label:"签名人"}},[e._v(e._s(e.applyRes.issuer))]),t("el-form-item",{attrs:{size:"mini",label:"签名"}},[e._v(e._s(e.applyRes.signatureName))]),t("el-form-item",{attrs:{size:"mini",label:"优先级"}},[e._v(e._s(e.applyRes.validityPeriod))])],1):e._e()],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.applyFormVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.applyForCert}},[e._v("申 请")])],1)],1)],1)},a=[],r=s("bc3a"),l=s.n(r);const o="/dpki/",n=l.a.create({baseURL:o});n.interceptors.request.use(e=>(e.headers["Access-Control-Allow-Origin"]="*",e.headers["Access-Control-Allow-Methods"]="GET, POST, PATCH, PUT, DELETE, OPTIONS",e.headers["Access-Control-Allow-Headers"]="Origin, Content-Type, X-Auth-Token",e.crossdomain=!0,e),e=>(console.log("[request error]",e),Promise.reject(e)));const c={list:function(){return new Promise((e,t)=>{n.request({url:"/IoTDevTest",method:"get"}).then(s=>{200===s.status?e(s.data):t(s)}).catch(t)})},revoke:function({no:e}){return new Promise((t,s)=>{n.request({url:"/RevokeABSCertificate",method:"get",params:{no:e}}).then(e=>{200===e.status?t(e.data):s(e)}).catch(s)})},certInfo:function(e){return new Promise((t,s)=>{n.request({url:"/GetCertificateByUID",method:"get",params:{uid:e}}).then(e=>{200===e.status?t(e.data):s(e)}).catch(s)})},apply:function(e,t){return new Promise((s,i)=>{n.request({url:"/ApplyForABSCertificate",method:"get",params:{uid:e,attribute:t}}).then(e=>{200===e.status?s(e.data):i(e)}).catch(i)})}};var p={name:"List",components:{},data(){return{certificates:[],emptyText:"暂无数据",detailVisible:!1,detail:{},applyFormVisible:!1,applyCert:{},applyRules:{uid:[{required:!0,trigger:"blur",message:"UID 不能为空"}],attribute:[{required:!0,trigger:"blur",message:"标签不能为空"}]},searchInput:"",applyRes:!1}},mounted(){this.emptyText="正在加载...",c.list().then(e=>{this.certificates=e.map(e=>(e=JSON.parse(e),e.certificate["absSignature"]=e.absSignature,e.certificate)),this.emptyText="暂无证书"}).catch(console.log)},methods:{detailInfo(e){this.detailVisible=!0,this.detail=e},revoke(e){const t=e.row.serialNumber;c.revoke({no:t}).then(t=>{"OK."===t?(this.$message({message:"撤销成功",duration:2e3,type:"success"}),this.certificates.splice(e.$index,1)):this.$message({message:t,type:"error"})}).catch(e=>{this.$message({message:e.message,type:"error"})})},applyForCert(){this.$refs.applyForm.validate(e=>{if(!e)return;const{uid:t,attribute:s}=this.applyCert;this.applyRes=!1,c.apply(t,s).then(e=>{e.certificate["absSignature"]=e.absSignature,this.applyRes=e.certificate,this.$message({message:"申请成功",duration:2e3,type:"success"})}).catch(e=>{this.$message({message:e.message,type:"error"})})})},searchCert(){const e=this.searchInput;e&&c.certInfo(e).then(e=>{e.certificate["absSignature"]=e.absSignature,this.certificates=[e.certificate]}).catch(e=>{this.$message({message:e.message,type:"error"})})}}},u=p,m=(s("adba"),s("2877")),d=Object(m["a"])(u,i,a,!1,null,"48a73b44",null);t["default"]=d.exports},adba:function(e,t,s){"use strict";s("e900")},e900:function(e,t,s){}}]);
//# sourceMappingURL=chunk-6fe3dc80.8a7e0f67.js.map