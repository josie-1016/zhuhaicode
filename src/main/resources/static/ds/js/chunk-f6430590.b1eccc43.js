(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f6430590"],{2400:function(e,t,a){"use strict";a("bfa2")},"53b3":function(e,t,a){"use strict";a("690a")},"604e":function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var r=a("b775"),o=a("bc3a"),s=a.n(o);const n={encrypt:function({userName:e,tags:t,file:a,policy:o}){const s=new FormData;return s.append("fileName",e),s.append("file",a),s.append("tags",t),s.append("policy",o),new Promise((e,t)=>{Object(r["a"])({url:"/content/upload",method:"post",headers:{"Content-Type":"multipart/form-data"},data:s,timeout:0}).then(a=>{200===a.code?e(a.data):t(a)}).catch(t)})},files:function({userName:e,tag:t,size:a,bookmark:o}){const s={userName:e,tag:t,size:a,bookmark:o},n={fromUserName:s.userName,tag:s.tag,pageSize:s.size||10,bookmark:s.bookmark};return new Promise((e,t)=>{Object(r["a"])({url:"/content/list",method:"get",data:n,params:n}).then(a=>{200===a.code?e(a.data):t(a)}).catch(t)})},decrypt:function({user:e,cipher:t,sharedUser:a,fileName:o,tags:s}){const n={userName:e,fileName:o,cipher:t,tags:s,sharedUser:a};return new Promise((e,t)=>{Object(r["a"])({url:"/content/decryption",method:"post",data:n}).then(a=>{200===a.code?e(a.data):t(a)}).catch(t)})},download:function({fileName:e,sharedUser:t}){const a={fileName:e,sharedUser:t};return new Promise((e,t)=>{s.a.request({baseURL:"/abe/",url:"/content/download",method:"get",data:a,params:a,responseType:"blob"}).then(a=>{200===a.status?e(a.data):t(a)}).catch(t)})},downloadCipher:function({userName:e,fileName:t,sharedUser:a}){const r={userName:e,fileName:t,sharedUser:a};return new Promise((e,t)=>{s.a.request({baseURL:"/abe/",url:"/content/cipher",method:"get",data:r,params:r,responseType:"blob"}).then(a=>{200===a.status?e(a.data):t(a)}).catch(t)})}}},6186:function(e,t,a){"use strict";a("7d6e")},"690a":function(e,t,a){},"6b79":function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));const r={methods:{formatTime(e){let t="-";try{t=new Date(1e3*e);var a=t.getFullYear(),r=t.getMonth()+1,o=t.getDate(),s=t.getHours(),n=t.getMinutes(),i=t.getSeconds(),l=`${a}-${r}-${o} ${s}:${n}:${i}`;return l}catch(c){console.log(c)}return t}}}},"752a":function(e,t,a){"use strict";var r=function(){var e=this,t=e._self._c;return t("el-table",{attrs:{data:e.files}},[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"文件名",prop:"fileName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"密文哈希",prop:"cipher"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"上传者",prop:"sharedUser"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"上传时间",prop:"timeStamp",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.timeStamp)+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"IP",prop:"ip",width:"130"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"加密策略",prop:"policy"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"标签",prop:"tags"},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(e.filterEmpty(a.row.tags),(function(a,r){return t("el-tag",{key:r,attrs:{size:"small",effect:"plain"}},[e._v(" "+e._s(a)+" ")])}))}}])}),t("el-table-column",{attrs:{label:"操作",align:"right",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.decryDownload(a.row)}}},[e._v(" 解密下载 ")]),t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.cipherDownload(a.row)}}},[e._v(" 下载密文 ")])]}}])})],1)},o=[],s=a("604e"),n=a("07a4"),i=a("eeef"),l=a("f778"),c=a("6b79"),u={name:"FilesTable",mixins:[i["a"],l["a"],c["a"]],props:{files:{type:Array,default:void 0}},methods:{decryDownload(e){const t=n["a"].userName(),{cipher:a,sharedUser:r,fileName:o,tags:i}=e;s["a"].decrypt({user:t,cipher:a,sharedUser:r,fileName:o,tags:i}).then(()=>s["a"].download({fileName:o,sharedUser:r}).then(e=>{this.saveFile(o,e)}).catch(e=>{this.$message({message:e.message,duration:5e3,type:"error"})})).catch(e=>{this.$message({message:e.message,duration:5e3,type:"error"})})},cipherDownload(e){const t=n["a"].userName(),{sharedUser:a,fileName:r}=e;s["a"].downloadCipher({userName:t,fileName:r,sharedUser:a}).then(e=>{this.saveFile("cipher_hash_"+r,e)}).catch(e=>{this.$message({message:e.message,duration:5e3,type:"error"})})}}},d=u,f=(a("6186"),a("2877")),p=Object(f["a"])(d,r,o,!1,null,"3b06acfe",null);t["a"]=p.exports},"7d6e":function(e,t,a){},ae8d:function(e,t,a){"use strict";var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"card"},[e.title?t("div",{staticClass:"card-head"},[e._v(" "+e._s(e.title)+" "),t("div",{staticStyle:{float:"right"}},[e._t("op")],2)]):e._e(),e._t("default")],2)},o=[],s={name:"Card",props:{title:{type:String,default:""}}},n=s,i=(a("b581"),a("2877")),l=Object(i["a"])(n,r,o,!1,null,"88a16ad0",null);t["a"]=l.exports},b581:function(e,t,a){"use strict";a("f619")},ba76:function(e,t,a){},bfa2:function(e,t,a){},e7db:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("transition-group",{staticClass:"grid-rows",attrs:{tag:"div",appear:""},on:{"before-enter":e.beforeEnter,enter:e.animEnter}},[t("Mine",{key:"0",attrs:{"data-index":"0.3"}}),t("Upload",{key:"1",attrs:{"data-index":"0"}})],1)},o=[],s=function(){var e=this,t=e._self._c;return t("Card",{attrs:{title:"我的文件"}},[t("FilesTable",{attrs:{files:e.files}})],1)},n=[],i=a("ae8d"),l=a("752a"),c=a("604e"),u=a("07a4"),d=a("eeef"),f=a("f778"),p={name:"Mine",mixins:[d["a"],f["a"]],components:{Card:i["a"],FilesTable:l["a"]},data(){return{files:[],bookmark:""}},mounted(){const e="",t=u["a"].userName(),{bookmark:a}=this;c["a"].files({userName:t,tag:e,bookmark:a}).then(e=>{this.files=e.contents,this.bookmark=e.bookmark}).catch(console.log)}},m=p,h=(a("53b3"),a("2877")),b=Object(h["a"])(m,s,n,!1,null,"4cbc9972",null),g=b.exports,y=function(){var e=this,t=e._self._c;return t("Card",{attrs:{title:"上传文件"}},[t("div",{staticClass:"grid-cols"},[t("el-form",{ref:"uploadForm",attrs:{"label-position":"left",rules:e.uploadRules,model:e.form,"label-width":"100px"}},[t("el-form-item",{attrs:{prop:"file",label:"* 选择文件"}},[t("input",{attrs:{type:"file",id:"input-file"}})]),t("el-form-item",{attrs:{prop:"policy",label:"策略表达式"}},[t("el-input",{attrs:{placeholder:"(A AND B AND (C OR D))"},model:{value:e.form.policy,callback:function(t){e.$set(e.form,"policy",t)},expression:"form.policy"}})],1),t("el-form-item",{attrs:{prop:"tags",label:"标签"}},[t("el-input",{attrs:{placeholder:"城市 系统 业务 备注（空格隔开）"},model:{value:e.form.tags,callback:function(t){e.$set(e.form,"tags",t)},expression:"form.tags"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.upload}},[e._v("上传到服务器")])],1)],1)],1)])},w=[],v=a("5c96"),k={name:"Upload",components:{Card:i["a"]},data(){return{form:{tags:"",policy:""},options:["shanghai","myc","edu","test"],uploadRules:{policy:[{required:!0,trigger:"blur",message:"请填写上传策略"}],tags:[{required:!0,trigger:"blur",message:"请设置标签"}]}}},watch:{},async mounted(){},methods:{selecedFile(e){this.file=e.file},handleRemove(e){this.$refs.upload.abort(e)},upload(){const e=document.querySelector("input[type=file]").files[0];if(console.log(e),!e)return void v["Notification"].error({title:"拒绝",message:"请添加文件",duration:2e3});let t=this.form.tags.split(" ");t.length<3?v["Notification"].error({title:"拒绝",message:"请补充完整的标签",duration:2e3}):this.$refs.uploadForm.validate(a=>{if(!a)return;const r=u["a"].userName(),o=this.form.policy;c["a"].encrypt({file:e,userName:r,tags:t,policy:o}).then(e=>{Object(v["Message"])({message:"上传成功",duration:5e3,type:"success"}),console.log(e)}).catch(e=>{Object(v["Message"])({message:e.message,duration:5e3,type:"error"})})})}}},N=k,_=(a("2400"),Object(h["a"])(N,y,w,!1,null,"0d104ec8",null)),U=_.exports,x={name:"Files",components:{Mine:g,Upload:U},methods:{beforeEnter:function(e){e.dataset.index>-1&&(e.style.opacity=.5,e.style.transform="translateX(30px)")},animEnter:function(e,t){var a=250*e.dataset.index;setTimeout((function(){e.style="",t()}),a)}}},C=x,$=(a("f4e8"),Object(h["a"])(C,r,o,!1,null,"287c16cc",null));t["default"]=$.exports},eeef:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));const r={methods:{saveFile(e,t){const a=window.URL.createObjectURL(new Blob([t])),r=document.createElement("a");r.href=a,r.setAttribute("download",e),document.body.appendChild(r),r.click()}}}},f4e8:function(e,t,a){"use strict";a("ba76")},f619:function(e,t,a){},f778:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));const r={methods:{filterEmpty(e){if(void 0==e)return"";if(Array.isArray(e)){let t=e.join(" ").split(" ").filter(e=>e);return t}return e}}}}}]);
//# sourceMappingURL=chunk-f6430590.b1eccc43.js.map