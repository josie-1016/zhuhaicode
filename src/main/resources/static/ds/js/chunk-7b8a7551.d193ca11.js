(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7b8a7551"],{"10f4":function(e,t,a){},"3bc5":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"files"},[t("Card",[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:6}},[t("el-input",{attrs:{placeholder:"请输入上传者",clearable:""},model:{value:e.filter.userName,callback:function(t){e.$set(e.filter,"userName",t)},expression:"filter.userName"}})],1),t("el-col",{attrs:{span:6}},[t("el-input",{attrs:{placeholder:"请输入包含的标签",clearable:""},model:{value:e.filter.tag,callback:function(t){e.$set(e.filter,"tag",t)},expression:"filter.tag"}})],1),t("el-col",{attrs:{span:12}},[t("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:e.search}},[e._v("筛选")])],1)],1)],1),t("Card",[t("FilesTable",{attrs:{files:e.files}})],1)],1)},s=[],o=a("ae8d"),n=a("752a"),i=a("604e"),l=a("eeef"),c=a("f778"),u={name:"AllFiles",components:{Card:o["a"],FilesTable:n["a"]},mixins:[l["a"],c["a"]],data(){return{files:[],bookmark:"",filter:{}}},mounted(){const e="",t="",{bookmark:a}=this;i["a"].files({userName:t,tag:e,bookmark:a}).then(e=>{this.files=e.contents,this.bookmark=e.bookmark}).catch(console.log)},methods:{search(){this.bookmark="";const{tag:e,userName:t}=this.filter,{bookmark:a}=this;i["a"].files({userName:t,tag:e,bookmark:a}).then(e=>{this.files=e.contents,this.bookmark=e.bookmark}).catch(console.log)}}},d=u,f=(a("8e20"),a("ac16"),a("2877")),m=Object(f["a"])(d,r,s,!1,null,"af197cce",null);t["default"]=m.exports},"604e":function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var r=a("b775"),s=a("bc3a"),o=a.n(s);const n={encrypt:function({userName:e,tags:t,file:a,policy:s,uploader:o}){const n=new FormData;return n.append("fileName",e),n.append("file",a),n.append("tags",t),n.append("policy",s),n.append("uploader",o),new Promise((e,t)=>{Object(r["a"])({url:"/content/upload",method:"post",headers:{"Content-Type":"multipart/form-data"},data:n,timeout:0}).then(a=>{200===a.code?e(a.data):t(a)}).catch(t)})},files:function({userName:e,tag:t,size:a,bookmark:s}){const o={userName:e,tag:t,size:a,bookmark:s},n={fromUserName:o.userName,tag:o.tag,pageSize:o.size||10,bookmark:o.bookmark};return new Promise((e,t)=>{Object(r["a"])({url:"/content/list",method:"get",data:n,params:n}).then(a=>{200===a.code?e(a.data):t(a)}).catch(t)})},decrypt:function({user:e,cipher:t,sharedUser:a,fileName:s,tags:o}){const n={userName:e,fileName:s,cipher:t,tags:o,sharedUser:a};return new Promise((e,t)=>{Object(r["a"])({url:"/content/decryption",method:"post",data:n}).then(a=>{200===a.code?e(a.data):t(a)}).catch(t)})},download:function({fileName:e,sharedUser:t}){const a={fileName:e,sharedUser:t};return new Promise((e,t)=>{o.a.request({baseURL:"/abe/",url:"/content/download",method:"get",data:a,params:a,responseType:"blob"}).then(a=>{200===a.status?e(a.data):t(a)}).catch(t)})},downloadCipher:function({userName:e,fileName:t,sharedUser:a}){const r={userName:e,fileName:t,sharedUser:a};return new Promise((e,t)=>{o.a.request({baseURL:"/abe/",url:"/content/cipher",method:"get",data:r,params:r,responseType:"blob"}).then(a=>{200===a.status?e(a.data):t(a)}).catch(t)})},verifySignature:function({userName:e,fileName:t,sharedUser:a}){const s={userName:e,fileName:t,sharedUser:a};return new Promise((e,t)=>{Object(r["a"])({url:"/content/verify",method:"post",data:s,params:s}).then(a=>{200===a.code?e(a.data):t(a)}).catch(t)})}}},"6b79":function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));const r={methods:{formatTime(e){let t="-";try{t=new Date(1e3*e);var a=t.getFullYear(),r=t.getMonth()+1,s=t.getDate(),o=t.getHours(),n=t.getMinutes(),i=t.getSeconds(),l=`${a}-${r}-${s} ${o}:${n}:${i}`;return l}catch(c){console.log(c)}return t}}}},"752a":function(e,t,a){"use strict";var r=function(){var e=this,t=e._self._c;return t("el-table",{attrs:{data:e.files}},[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"文件名",prop:"fileName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"密文哈希",prop:"cipher"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"上传者",prop:"sharedUser"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"上传时间",prop:"timeStamp",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.timeStamp)+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"加密策略",prop:"policy"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"标签",prop:"tags"},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(e.filterEmpty(a.row.tags),(function(a,r){return t("el-tag",{key:r,attrs:{size:"small",effect:"plain"}},[e._v(" "+e._s(a)+" ")])}))}}])}),t("el-table-column",{attrs:{label:"操作",align:"right",width:"300"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.verifySignature(a.row)}}},[e._v(" 验签 ")]),t("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.decryDownload(a.row)}}},[e._v(" 解密下载 ")]),t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.cipherDownload(a.row)}}},[e._v(" 下载密文 ")])]}}])})],1)},s=[],o=a("604e"),n=a("07a4"),i=a("eeef"),l=a("f778"),c=a("6b79"),u=a("5c96"),d={name:"FilesTable",mixins:[i["a"],l["a"],c["a"]],props:{files:{type:Array,default:void 0}},methods:{decryDownload(e){const t=n["a"].userName(),{cipher:a,sharedUser:r,fileName:s,tags:i}=e;o["a"].decrypt({user:t,cipher:a,sharedUser:r,fileName:s,tags:i}).then(()=>o["a"].download({fileName:s,sharedUser:r}).then(e=>{this.saveFile(s,e)}).catch(e=>{this.$message({message:e.message,duration:5e3,type:"error"})})).catch(e=>{this.$message({message:e.message,duration:5e3,type:"error"})})},cipherDownload(e){const t=n["a"].userName(),{sharedUser:a,fileName:r}=e;o["a"].downloadCipher({userName:t,fileName:r,sharedUser:a}).then(e=>{this.saveFile("cipher_hash_"+r,e)}).catch(e=>{this.$message({message:e.message,duration:5e3,type:"error"})})},verifySignature(e){const t=n["a"].userName(),{sharedUser:a,fileName:r}=e;o["a"].verifySignature({userName:t,fileName:r,sharedUser:a}).then(e=>{Object(u["Message"])({message:"验签通过",duration:5e3,type:"success"}),console.log(e)}).catch(e=>{Object(u["Message"])({message:e.message,duration:5e3,type:"error"})})}}},f=d,m=(a("d9dd"),a("2877")),p=Object(m["a"])(f,r,s,!1,null,"724759ab",null);t["a"]=p.exports},"8e20":function(e,t,a){"use strict";a("9483")},9483:function(e,t,a){},ac16:function(e,t,a){"use strict";a("f599")},ae8d:function(e,t,a){"use strict";var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"card"},[e.title?t("div",{staticClass:"card-head"},[e._v(" "+e._s(e.title)+" "),t("div",{staticStyle:{float:"right"}},[e._t("op")],2)]):e._e(),e._t("default")],2)},s=[],o={name:"Card",props:{title:{type:String,default:""}}},n=o,i=(a("b581"),a("2877")),l=Object(i["a"])(n,r,s,!1,null,"88a16ad0",null);t["a"]=l.exports},b581:function(e,t,a){"use strict";a("f619")},d9dd:function(e,t,a){"use strict";a("10f4")},eeef:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));const r={methods:{saveFile(e,t){const a=window.URL.createObjectURL(new Blob([t])),r=document.createElement("a");r.href=a,r.setAttribute("download",e),document.body.appendChild(r),r.click()}}}},f599:function(e,t,a){},f619:function(e,t,a){},f778:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));const r={methods:{filterEmpty(e){if(void 0==e)return"";if(Array.isArray(e)){let t=e.join(" ").split(" ").filter(e=>e);return t}return e}}}}}]);
//# sourceMappingURL=chunk-7b8a7551.d193ca11.js.map