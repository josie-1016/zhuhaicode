(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-905db9c0"],{"02a4":function(e,t,a){"use strict";a("8165")},"2a32":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));a("0721");var r=a("b775"),o={create:function(e){var t={fileName:e.userName,t:e.threshold,n:e.usersNum,users:e.users,orgName:e.orgName};return new Promise((function(e,a){Object(r["a"])({url:"/org/apply/creation",method:"post",data:t}).then((function(t){200===t.code?e(t.data):a(t)})).catch(a)}))},join:function(e){var t=e.userName,a=e.orgName,o={fileName:t,orgName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply/creation/approval",method:"post",data:o}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},submitppk:function(e){var t=e.orgName,a=e.userName,o={type:"CREATION",orgName:t,fileName:a,attrName:""};return new Promise((function(e,t){Object(r["a"])({url:"/org/part-pk",method:"post",params:o}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},submitOrgAttppk:function(e){var t=e.orgName,a=e.userName,o=e.attrName,n={type:"ATTRIBUTE",orgName:t,fileName:a,attrName:o};return new Promise((function(e,t){Object(r["a"])({url:"/org/part-pk",method:"post",params:n}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},completeOrg:function(e){var t=e.orgName,a=e.userName,r={type:"CREATION",orgName:t,userName:a,attrName:""};return this.complete(r)},completeOrgAttr:function(e){var t=e.orgName,a=e.userName,r=e.attrName;return this.complete({type:"ATTRIBUTE",orgName:t,userName:a,attrName:r})},complete:function(e){var t=e.type,a=e.orgName,o=e.userName,n=e.attrName,s={type:t,orgName:a,fileName:o,attrName:n};return new Promise((function(e,t){Object(r["a"])({url:"/org/complete-pk",method:"post",params:s}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},tempOrgInfo:function(e){var t=e.orgName,a={type:"CREATION",orgName:t,attrName:""};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply",method:"get",params:a}).then((function(a){200===a.code?e(a.data):t(a)})).catch((function(e){e?console.log(e):t(e)}))}))},tempOrgAttrInfo:function(e){var t=e.orgName,a=e.attrName,o={type:"ATTRIBUTE",orgName:t,attrName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply",method:"get",params:o}).then((function(a){200===a.code?e(a.data):t(a)})).catch((function(e){e?console.log(e):t(e)}))}))},detailInfo:function(e){var t=e.orgName,a={orgName:t};return new Promise((function(e,t){Object(r["a"])({url:"/org/",method:"get",params:a}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},declareAttr:function(e){var t=e.orgName,a=e.userName,o=e.attrName,n={orgName:t,fileName:a,attrName:o};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply/attribute",method:"post",data:n}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},approvalAttr:function(e){var t=e.userName,a=e.orgName,o=e.attrName,n={fileName:t,orgName:a,attrName:o};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply/attribute/approval",method:"post",data:n}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))}}},"477a":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition-group",{staticClass:"grid-rows",attrs:{tag:"div",appear:""},on:{"before-enter":e.beforeEnter,enter:e.animEnter}},[e.isExist?a("Mine",{key:"0",attrs:{"data-index":"0"},on:{refresh:e.refresh}}):e._e()],1)},o=[],n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Card",{attrs:{title:"我的组织"},scopedSlots:e._u([{key:"op",fn:function(){return[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.joinDialogFormVisible=!0}}},[e._v(" 加入组织 ")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){e.applyDialogFormVisible=!0}}},[e._v(" 申请创建组织 ")])]},proxy:!0}])},[e.OPKMap?a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.formatOrganization(e.OPKMap)}},[a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"name",label:"组织名称",width:"180"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"value",label:"组织公钥"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.value||"暂无")+" ")]}}],null,!1,508938292)}),a("el-table-column",{attrs:{label:"操作",width:"480",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.approveThresholdPartSK(t.row)}}},[e._v(" 同意门限公钥生成 ")]),a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.submitThresholdPartSk(t.row)}}},[e._v(" 申请门限公钥生成 ")]),a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.submitPartPK(t.row)}}},[e._v(" 提交组织秘密 ")])]}}],null,!1,720029311)})],1)],1):a("el-empty",{attrs:{"image-size":100,description:"没有正在申请的属性"}})],1),a("el-dialog",{attrs:{title:"申请成立新组织",visible:e.applyDialogFormVisible},on:{"update:visible":function(t){e.applyDialogFormVisible=t}}},[a("el-form",{ref:"applyForm",attrs:{rules:e.applyRules,model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{prop:"orgName",label:"组织名称"}},[a("el-input",{attrs:{placeholder:"请输入组织名称"},model:{value:e.form.orgName,callback:function(t){e.$set(e.form,"orgName",t)},expression:"form.orgName"}})],1),a("el-form-item",{attrs:{prop:"threshold",label:"阈值"}},[a("el-input",{attrs:{placeholder:"请输入阈值"},model:{value:e.form.threshold,callback:function(t){e.$set(e.form,"threshold",t)},expression:"form.threshold"}})],1),a("el-form-item",{attrs:{prop:"userStr",label:"其它成员"}},[a("el-input",{attrs:{placeholder:"请输入除您之外包含的其它成员 以空格区分成员名"},model:{value:e.form.userStr,callback:function(t){e.$set(e.form,"userStr",t)},expression:"form.userStr"}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.applyDialogFormVisible=!1}}},[e._v("取 消")]),a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary"},on:{click:e.applyForOrg}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"加入组织",visible:e.joinDialogFormVisible},on:{"update:visible":function(t){e.joinDialogFormVisible=t}}},[a("el-form",{ref:"joinForm",attrs:{rules:e.joinRules,model:e.joinForm,"label-width":"80px"}},[a("el-form-item",{attrs:{prop:"orgName",label:"组织名称"}},[a("el-input",{attrs:{placeholder:"请输入组织名称"},model:{value:e.joinForm.orgName,callback:function(t){e.$set(e.joinForm,"orgName",t)},expression:"joinForm.orgName"}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.joinDialogFormVisible=!1}}},[e._v("取 消")]),a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary"},on:{click:e.joinOrg}},[e._v("确 定")])],1)],1)],1)},s=[],i=a("cc39"),l=(a("1a55"),a("ac30"),a("f6a5"),a("0721"),a("8281"),a("bdf9"),a("ae8d")),c=a("2a32"),m=a("07a4"),u=a("9351"),f={name:"Mine",components:{Card:l["a"]},computed:Object(i["a"])({},m["a"].mapUser(["OPKMap"])),data:function(){return{fullscreenLoading:!1,applyDialogFormVisible:!1,form:{threshold:"",userStr:"",orgName:""},applyRules:{orgName:[{required:!0,trigger:"blur",message:"组织名不能为空"}],threshold:[{required:!0,trigger:"blur",message:"阈值不能为空"}],userStr:[{required:!0,trigger:"blur",message:"成员不能为空"}]},joinDialogFormVisible:!1,joinForm:{orgName:""},joinRules:{orgName:[{required:!0,trigger:"blur",message:"组织名不能为空"}]}}},methods:{formatOrganization:function(e){for(var t=[],a=0,r=Object.keys(e);a<r.length;a++){var o=r[a];t.push({name:o,value:e[o].OPK})}return t},applyForOrg:function(){var e=this,t=m["a"].userName();t&&this.$refs.applyForm.validate((function(a){if(a){var r=e.form,o=r.threshold,n=r.userStr,s=r.orgName,i=n.split(" ");i.push(t),e.fullscreenLoading=!0,c["a"].create({userName:t,threshold:o,users:i,orgName:s,usersNum:i.length}).then((function(){e.fullscreenLoading=!1,e.$message({message:"申请组织创建成功",duration:2e3,type:"success"}),c["a"].join({userName:t,orgName:s}).then((function(){e.$message({message:"加入组织成功",duration:2e3,type:"success"})})).catch((function(t){e.$message({message:t.message,type:"error"})}))})).catch((function(t){e.fullscreenLoading=!1,e.$message({message:t.message,type:"error"})})).finally((function(){e.applyDialogFormVisible=!1}))}}))},joinOrg:function(){var e=this,t=m["a"].userName();t&&this.$refs.joinForm.validate((function(a){if(a){var r=e.joinForm.orgName;e.fullscreenLoading=!0,c["a"].join({userName:t,orgName:r}).then((function(){e.fullscreenLoading=!1,e.$message({message:"加入成功",duration:2e3,type:"success"})})).catch((function(t){e.fullscreenLoading=!1,e.$message({message:t.message,type:"error"})})).finally((function(){e.joinDialogFormVisible=!1,location.reload()}))}}))},submitPartPK:function(e){var t=this,a=m["a"].userName();this.fullscreenLoading=!0,c["a"].submitppk({userName:a,orgName:e.name}).then((function(){t.fullscreenLoading=!1,t.$message({message:"提交成功",duration:2e3,type:"success"}),t.trycompleteOrgPK(a,e.name)})).catch((function(e){t.fullscreenLoading=!1,t.$message({message:e.message,type:"error"})}))},submitThresholdPartSk:function(e){var t=this,a=m["a"].userName();console.log(a),console.log("11111111111111"),u["a"].applyThresholdOrgPartSk({orgName:e.name,uid:a}).then((function(){t.$message({message:"提交成功",duration:2e3,type:"success"}),console.log("门限公钥申请")})).catch((function(e){t.$message({message:e.message,type:"error"})}))},approveThresholdPartSK:function(e){var t=this,a=m["a"].userName();console.log(a),console.log("11111111111111"),u["a"].approveThresholdOrgPartSk({orgName:e.name,uid:a}).then((function(){t.$message({message:"提交成功",duration:2e3,type:"success"}),console.log("门限公钥同意"),t.tryThresholdCompleteOrgPK(e.name,a)})).catch((function(e){t.$message({message:e.message,type:"error"})}))},trycompleteOrgPK:function(e,t){var a=this;c["a"].completeOrg({userName:e,orgName:t}).then((function(){a.$message({message:"组织已确认创建",duration:2e3,type:"success"}),location.reload()})).catch(console.log)},tryThresholdCompleteOrgPK:function(e,t){var a=this;u["a"].completeThresholdOrgPartSk({orgName:e,uid:t}).then((function(){a.$message({message:"组织已确认创建",duration:2e3,type:"success"})})).catch(console.log)}}},p=f,d=a("52e0"),g=Object(d["a"])(p,n,s,!1,null,null,null),h=g.exports,N={name:"Organizations",components:{Mine:h},data:function(){return{attributes:[],isExist:!0}},methods:{beforeEnter:function(e){e.dataset.index>-1&&(e.style.opacity=.5,e.style.transform="translateX(30px)")},animEnter:function(e,t){var a=250*e.dataset.index;setTimeout((function(){e.style="",t()}),a)},refresh:function(){var e=this;this.isExist=!1,this.$nextTick((function(){e.isExist=!0}))}}},b=N,v=(a("02a4"),Object(d["a"])(b,r,o,!1,null,"23850615",null));t["default"]=v.exports},8165:function(e,t,a){},9351:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));a("0721");var r=a("b775"),o=a("4f14"),n=a.n(o),s={encryptThreshold:function(e){var t=e.file,a=e.org,o=new FormData;return o.append("file",t),o.append("orgName",a),new Promise((function(e,t){Object(r["a"])({url:"/content/thresholdUpload",method:"post",headers:{"Content-Type":"multipart/form-data"},data:o,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},orgSearchThreshold:function(e){var t=e.orgName,a=e.fileName,o=e.fromUid,n={orgName:t,fileName:a,fromUid:o};return new Promise((function(e,t){Object(r["a"])({url:"/content/threshold/orgList",method:"get",headers:{"Content-Type":"multipart/form-data"},params:n,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},searchThreshold:function(e){var t=e.orgName,a=e.fileName,o={orgName:t,fileName:a},n={orgName:o.orgName,fileName:o.fileName};return new Promise((function(e,t){Object(r["a"])({url:"/content/threshold/list",method:"get",headers:{"Content-Type":"multipart/form-data"},params:n,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},approvalThreshold:function(e){var t=e.userName,a=e.org,o=e.fileName,n=e.fromUid,s={orgName:a,fileName:o,uid:t,fromUid:n};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply/ThresholdFile/approval",method:"post",headers:{"Content-Type":"multipart/form-data"},params:s,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},applyThresholdOrgPartSk:function(e){var t=e.orgName,a=e.uid,o={orgName:t,userName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/threshold/apply-part-sk",method:"post",params:o,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},approveThresholdOrgPartSk:function(e){var t=e.orgName,a=e.uid,o={orgName:t,userName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/threshold/approve-part-sk",method:"post",params:o,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},completeThresholdOrgPartSk:function(e){var t=e.orgName,a=e.uid,o={orgName:t,userName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/Threshold/complete-pk",method:"post",params:o,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},tryApplyThresholdFile:function(e){var t=e.orgName,a=e.user,o=e.fileName,n={orgName:t,fileName:o,userName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply/threshold",method:"post",data:n}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},decrypt:function(e){var t=e.orgName,a=e.userName,o=e.fileName,n={userName:a,orgName:t,fileName:o};return console.log(n),new Promise((function(e,t){Object(r["a"])({url:"/content/thresholdDecrypt",method:"get",params:n}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},download:function(e){var t=e.fileName,a=e.orgName,r={fileName:t,orgName:a};return new Promise((function(e,t){n.a.request({baseURL:"/abe/",url:"/content/thresholdDownload",method:"get",data:r,params:r,responseType:"blob"}).then((function(a){200===a.status?e(a.data):t(a)})).catch(t)}))}}},ae8d:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"card"},[e.title?a("div",{staticClass:"card-head"},[e._v(" "+e._s(e.title)+" "),a("div",{staticStyle:{float:"right"}},[e._t("op")],2)]):e._e(),e._t("default")],2)},o=[],n={name:"Card",props:{title:{type:String,default:""}}},s=n,i=(a("e24e"),a("52e0")),l=Object(i["a"])(s,r,o,!1,null,"88a16ad0",null);t["a"]=l.exports},e24e:function(e,t,a){"use strict";a("e826")},e826:function(e,t,a){}}]);
//# sourceMappingURL=chunk-905db9c0.5d22e3e1.js.map