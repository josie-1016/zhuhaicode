(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0808fff7"],{"0818":function(e,t,a){"use strict";a("f3fd")},"263d":function(e,t,a){},"4b73":function(e,t,a){"use strict";a("263d")},"6b79":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));const o={methods:{formatTime(e){let t="-";try{t=new Date(1e3*e);var a=t.getFullYear(),o=t.getMonth()+1,r=t.getDate(),s=t.getHours(),n=t.getMinutes(),i=t.getSeconds(),l=`${a}-${o}-${r} ${s}:${n}:${i}`;return l}catch(c){console.log(c)}return t}}}},"7cc2":function(e,t,a){"use strict";a("aa0f")},aa0f:function(e,t,a){},ae8d:function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"card"},[e.title?t("div",{staticClass:"card-head"},[e._v(" "+e._s(e.title)+" "),t("div",{staticStyle:{float:"right"}},[e._t("op")],2)]):e._e(),e._t("default")],2)},r=[],s={name:"Card",props:{title:{type:String,default:""}}},n=s,i=(a("b581"),a("2877")),l=Object(i["a"])(n,o,r,!1,null,"88a16ad0",null);t["a"]=l.exports},b2a8:function(e,t,a){},b581:function(e,t,a){"use strict";a("f619")},d956:function(e,t,a){"use strict";a("b2a8")},e7db:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("transition-group",{staticClass:"grid-rows",attrs:{tag:"div",appear:""},on:{"before-enter":e.beforeEnter,enter:e.animEnter}},[t("Mine",{key:"0",attrs:{"data-index":"0.3"}}),t("Upload",{key:"1",attrs:{"data-index":"0"}})],1)},r=[],s=function(){var e=this,t=e._self._c;return t("Card",{attrs:{title:"我的定向传输文件"}},[t("SM2FilesTable",{attrs:{files:e.files}})],1)},n=[],i=a("ae8d"),l=function(){var e=this,t=e._self._c;return t("el-table",{attrs:{data:e.files}},[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"文件名",prop:"fileName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"密文哈希",prop:"cipher"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"上传者",prop:"sharedUser"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"接收者",prop:"toName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"上传时间",prop:"timeStamp",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.timeStamp)+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",align:"right",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.decryDownload(a.row)}}},[e._v(" 解密下载 ")]),t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.cipherDownload(a.row)}}},[e._v(" 下载密文 ")])]}}])})],1)},c=[],u=a("b775"),d=a("bc3a"),m=a.n(d);const f={encrypt:function({userName:e,toName:t,file:a}){const o=new FormData;return o.append("userName",e),o.append("file",a),o.append("toName",t),new Promise((e,t)=>{Object(u["a"])({url:"/SM2content/upload",method:"post",headers:{"Content-Type":"multipart/form-data"},data:o,timeout:0}).then(a=>{200===a.code?e(a.data):t(a)}).catch(t)})},files:function({userName:e,toName:t,size:a,bookmark:o}){const r={userName:e,toName:t,size:a,bookmark:o},s={fromUserName:r.userName,toName:r.toName,pageSize:r.size||10,bookmark:r.bookmark};return new Promise((e,t)=>{Object(u["a"])({url:"/SM2content/list",method:"get",data:s,params:s}).then(a=>{200===a.code?e(a.data):t(a)}).catch(t)})},download:function({user:e,cipher:t,sharedUser:a,fileName:o,toName:r}){const s={userName:e,fileName:o,cipher:t,toName:r,sharedUser:a};return new Promise((e,t)=>{m.a.request({baseURL:"/abe/",url:"/SM2content/download",method:"get",data:s,params:s,responseType:"blob"}).then(a=>{200===a.status?e(a.data):t(a)}).catch(t)})},downloadCipher:function({userName:e,fileName:t,sharedUser:a}){const o={userName:e,fileName:t,sharedUser:a};return new Promise((e,t)=>{m.a.request({baseURL:"/abe/",url:"/SM2content/cipher",method:"get",data:o,params:o,responseType:"blob"}).then(a=>{200===a.status?e(a.data):t(a)}).catch(t)})}};var p=a("07a4"),h=a("eeef"),b=a("f778"),N=a("6b79"),w={name:"SM2FilesTable",mixins:[h["a"],b["a"],N["a"]],props:{files:{type:Array,default:void 0}},methods:{decryDownload(e){const t=p["a"].userName(),{cipher:a,sharedUser:o,fileName:r,toName:s}=e;f.download({user:t,cipher:a,sharedUser:o,fileName:r,toName:s}).then(e=>{this.saveFile(r,e)}).catch(e=>{this.$message({message:e.message,duration:5e3,type:"error"})})},cipherDownload(e){const t=p["a"].userName(),{sharedUser:a,fileName:o}=e;f.downloadCipher({userName:t,fileName:o,sharedUser:a}).then(e=>{this.saveFile("cipher_hash_"+o,e)}).catch(e=>{this.$message({message:e.message,duration:5e3,type:"error"})})}}},g=w,y=(a("7cc2"),a("2877")),v=Object(y["a"])(g,l,c,!1,null,"80dad280",null),k=v.exports,_={name:"Mine",mixins:[h["a"],b["a"]],components:{Card:i["a"],SM2FilesTable:k},data(){return{files:[],bookmark:""}},mounted(){const e=p["a"].userName(),t=p["a"].userName(),{bookmark:a}=this;f.files({userName:t,toName:e,bookmark:a}).then(e=>{this.files=e.contents,this.bookmark=e.bookmark}).catch(console.log)}},S=_,U=(a("0818"),Object(y["a"])(S,s,n,!1,null,"3ce5d9cb",null)),M=U.exports,x=function(){var e=this,t=e._self._c;return t("Card",{attrs:{title:"上传文件"}},[t("div",{staticClass:"grid-cols"},[t("el-form",{ref:"uploadForm",attrs:{"label-position":"left",rules:e.uploadRules,model:e.form,"label-width":"100px"}},[t("el-form-item",{attrs:{prop:"file",label:"* 选择文件"}},[t("input",{attrs:{type:"file",id:"input-file"}})]),t("el-form-item",{attrs:{prop:"toName",label:"定向用户"}},[t("el-input",{attrs:{placeholder:"zhuhaitest"},model:{value:e.form.toName,callback:function(t){e.$set(e.form,"toName",t)},expression:"form.toName"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.upload}},[e._v("上传到服务器")])],1)],1)],1)])},C=[],F=a("5c96"),j={name:"Upload",components:{Card:i["a"]},data(){return{form:{toName:""},uploadRules:{toName:[{required:!0,trigger:"blur",message:"请填写文件传输对象"}]}}},watch:{},async mounted(){},methods:{selecedFile(e){this.file=e.file},handleRemove(e){this.$refs.upload.abort(e)},upload(){const e=document.querySelector("input[type=file]").files[0];console.log(e),e?this.$refs.uploadForm.validate(t=>{if(!t)return;const a=p["a"].userName(),o=this.form.toName;f.encrypt({userName:a,toName:o,file:e}).then(e=>{Object(F["Message"])({message:"上传成功",duration:5e3,type:"success"}),console.log(e)}).catch(e=>{Object(F["Message"])({message:e.message,duration:5e3,type:"error"})})}):F["Notification"].error({title:"拒绝",message:"请添加文件",duration:2e3})}}},$=j,O=(a("4b73"),Object(y["a"])($,x,C,!1,null,"76fdb05b",null)),T=O.exports,z={name:"SM2Files",components:{Mine:M,Upload:T},methods:{beforeEnter:function(e){e.dataset.index>-1&&(e.style.opacity=.5,e.style.transform="translateX(30px)")},animEnter:function(e,t){var a=250*e.dataset.index;setTimeout((function(){e.style="",t()}),a)}}},D=z,R=(a("d956"),Object(y["a"])(D,o,r,!1,null,"3e00b0c8",null));t["default"]=R.exports},eeef:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));const o={methods:{saveFile(e,t){const a=window.URL.createObjectURL(new Blob([t])),o=document.createElement("a");o.href=a,o.setAttribute("download",e),document.body.appendChild(o),o.click()}}}},f3fd:function(e,t,a){},f619:function(e,t,a){},f778:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));const o={methods:{filterEmpty(e){if(void 0==e)return"";if(Array.isArray(e)){let t=e.join(" ").split(" ").filter(e=>e);return t}return e}}}}}]);
//# sourceMappingURL=chunk-0808fff7.f4ded487.js.map