(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-61cfb7d2"],{"1cc8":function(e,t,a){},"297a":function(e,t,a){"use strict";a("aad2")},4969:function(e,t,a){"use strict";a("1cc8")},5625:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition-group",{staticClass:"grid-rows",attrs:{tag:"div",appear:""},on:{"before-enter":e.beforeEnter,enter:e.animEnter}},[a("Upload",{key:"1",attrs:{"data-index":"0"}}),a("Search",{key:"2",attrs:{"data-index":"0"}})],1)},o=[],n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Card",{attrs:{title:"上传文件"}},[a("div",{staticClass:"grid-cols"},[a("el-form",{ref:"uploadForm",attrs:{"label-position":"left",rules:e.uploadRules,model:e.form,"label-width":"100px"}},[a("el-form-item",{attrs:{prop:"file",label:"选择文件"}},[a("input",{attrs:{type:"file",id:"input-file"}})]),a("el-form-item",{attrs:{prop:"org",label:"组织"}},[a("el-input",{attrs:{placeholder:"请填写你的组织名称"},model:{value:e.form.org,callback:function(t){e.$set(e.form,"org",t)},expression:"form.org"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.upload}},[e._v("上传到服务器")])],1)],1)],1)])},i=[],l=a("723b"),s=(a("d065"),a("9351")),c=a("ae8d"),u=a("70f6"),f={name:"Upload",components:{Card:c["a"]},data:function(){return{form:{org:""},options:["shanghai","myc","edu","test"],uploadRules:{org:[{required:!0,trigger:"blur",message:"请填写上传组织"}]}}},watch:{},mounted:function(){return Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},methods:{selecedFile:function(e){this.file=e.file},handleRemove:function(e){this.$refs.upload.abort(e)},upload:function(){var e=this,t=document.querySelector("input[type=file]").files[0];console.log(t),t?this.$refs.uploadForm.validate((function(a){if(a){var r=e.form.org;s["a"].encryptThreshold({file:t,org:r}).then((function(e){Object(u["Message"])({message:"上传成功",duration:5e3,type:"success"}),console.log(e)})).catch((function(e){Object(u["Message"])({message:e.message,duration:5e3,type:"error"})}))}})):u["Notification"].error({title:"拒绝",message:"请添加文件",duration:2e3})}}},m=f,d=(a("297a"),a("52e0")),h=Object(d["a"])(m,n,i,!1,null,"e293af80",null),p=h.exports,g=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Card",{attrs:{title:"门限文件搜索"}},[a("div",{staticStyle:{"margin-bottom":"15px"}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:7}},[a("el-input",{attrs:{placeholder:"请输入要搜索的上传者的组织"},model:{value:e.filter.orgName,callback:function(t){e.$set(e.filter,"orgName",t)},expression:"filter.orgName"}})],1),a("el-col",{attrs:{span:7}},[a("el-input",{attrs:{placeholder:"请输入要搜索的文件名"},model:{value:e.filter.fileName,callback:function(t){e.$set(e.filter,"fileName",t)},expression:"filter.fileName"}})],1),a("el-col",{attrs:{span:2}},[a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:e.search}},[e._v("筛选")])],1)],1)],1),a("ThresholdTable",{attrs:{files:e.files}})],1)},b=[],N=(a("5cf2"),a("0721"),a("6b79")),v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-table",{attrs:{data:e.files}},[a("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"文件名",prop:"fileName"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"组织",prop:"sharedUser"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"上传时间",prop:"timeStamp",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.timeStamp)+" ")]}}])}),a("el-table-column",{attrs:{label:"操作",align:"right",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return e.decryDownload(t.row)}}},[e._v(" 申请解密 ")]),a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.cipherDownload(t.row)}}},[e._v(" 下载 ")])]}}])})],1)},y=[],w=a("07a4"),k=a("eeef"),T=a("f778"),_={name:"FilesTable",mixins:[k["a"],T["a"],N["a"]],props:{files:{type:Array,default:void 0}},methods:{decryDownload:function(e){var t=this,a=w["a"].userName(),r=e.fileName,o=e.sharedUser;console.log(r,o,a),s["a"].tryApplyThresholdFile({orgName:o,user:a,fileName:r}).then((function(e){console.log(e),Object(u["Message"])({message:"申请成功",duration:5e3,type:"success"})})).catch((function(e){t.$message({message:e.message,duration:5e3,type:"error"})}))},cipherDownload:function(e){var t=this,a=w["a"].userName(),r=e.sharedUser,o=e.fileName,n=r;console.log(a,n,o),s["a"].decrypt({orgName:n,userName:a,fileName:o}).then((function(){return s["a"].download({fileName:o,orgName:n}).then((function(e){t.saveFile(o,e)})).catch((function(e){t.$message({message:e.message,duration:5e3,type:"error"})}))})).catch((function(e){t.$message({message:e.message,duration:5e3,type:"error"})}))}}},O=_,j=(a("b135"),Object(d["a"])(O,v,y,!1,null,"72320f89",null)),S=j.exports,x={name:"Search",mixins:[N["a"]],components:{Card:c["a"],ThresholdTable:S},data:function(){return{filter:{},files:[],bookmark:""}},methods:{search:function(){var e=this;this.bookmark="";var t=this.filter,a=t.orgName,r=t.fileName;if(null==a)alert("没有填写机构名");else{var o=this.bookmark;s["a"].searchThreshold({orgName:a,fileName:r}).then((function(t){e.files=t.contents,console.log(e.files),console.log(t),console.log("111111111111111111111111")})).catch(console.log),console.log(r,a,o)}}}},C=x,U=Object(d["a"])(C,g,b,!1,null,null,null),P=U.exports,$={name:"Threshold",components:{Search:P,Upload:p}},F=$,D=(a("4969"),Object(d["a"])(F,r,o,!1,null,"71d779fc",null));t["default"]=D.exports},"6b79":function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));a("106c");var r={methods:{formatTime:function(e){if(""===e)return"";var t="-";try{t=new Date(1e3*e);var a=t.getFullYear(),r=t.getMonth()+1,o=t.getDate(),n=t.getHours(),i=t.getMinutes(),l=t.getSeconds(),s="".concat(a,"-").concat(r,"-").concat(o," ").concat(n,":").concat(i,":").concat(l);return s}catch(c){console.log(c)}return t}}}},9351:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));a("0721");var r=a("b775"),o=a("4f14"),n=a.n(o),i={encryptThreshold:function(e){var t=e.file,a=e.org,o=new FormData;return o.append("file",t),o.append("orgName",a),new Promise((function(e,t){Object(r["a"])({url:"/content/thresholdUpload",method:"post",headers:{"Content-Type":"multipart/form-data"},data:o,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},orgSearchThreshold:function(e){var t=e.orgName,a=e.fileName,o=e.fromUid,n={orgName:t,fileName:a,fromUid:o};return new Promise((function(e,t){Object(r["a"])({url:"/content/threshold/orgList",method:"get",headers:{"Content-Type":"multipart/form-data"},params:n,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},searchThreshold:function(e){var t=e.orgName,a=e.fileName,o={orgName:t,fileName:a},n={orgName:o.orgName,fileName:o.fileName};return new Promise((function(e,t){Object(r["a"])({url:"/content/threshold/list",method:"get",headers:{"Content-Type":"multipart/form-data"},params:n,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},approvalThreshold:function(e){var t=e.userName,a=e.org,o=e.fileName,n=e.fromUid,i={orgName:a,fileName:o,uid:t,fromUid:n};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply/ThresholdFile/approval",method:"post",headers:{"Content-Type":"multipart/form-data"},params:i,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},applyThresholdOrgPartSk:function(e){var t=e.orgName,a=e.uid,o={orgName:t,userName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/threshold/apply-part-sk",method:"post",params:o,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},approveThresholdOrgPartSk:function(e){var t=e.orgName,a=e.uid,o={orgName:t,userName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/threshold/approve-part-sk",method:"post",params:o,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},completeThresholdOrgPartSk:function(e){var t=e.orgName,a=e.uid,o={orgName:t,userName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/Threshold/complete-pk",method:"post",params:o,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},tryApplyThresholdFile:function(e){var t=e.orgName,a=e.user,o=e.fileName,n={orgName:t,fileName:o,userName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply/threshold",method:"post",data:n}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},decrypt:function(e){var t=e.orgName,a=e.userName,o=e.fileName,n={userName:a,orgName:t,fileName:o};return console.log(n),new Promise((function(e,t){Object(r["a"])({url:"/content/thresholdDecrypt",method:"get",params:n}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},download:function(e){var t=e.fileName,a=e.orgName,r={fileName:t,orgName:a};return new Promise((function(e,t){n.a.request({baseURL:"/abe/",url:"/content/thresholdDownload",method:"get",data:r,params:r,responseType:"blob"}).then((function(a){200===a.status?e(a.data):t(a)})).catch(t)}))}}},aad2:function(e,t,a){},ae8d:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"card"},[e.title?a("div",{staticClass:"card-head"},[e._v(" "+e._s(e.title)+" "),a("div",{staticStyle:{float:"right"}},[e._t("op")],2)]):e._e(),e._t("default")],2)},o=[],n={name:"Card",props:{title:{type:String,default:""}}},i=n,l=(a("e24e"),a("52e0")),s=Object(l["a"])(i,r,o,!1,null,"88a16ad0",null);t["a"]=s.exports},b135:function(e,t,a){"use strict";a("ba06")},ba06:function(e,t,a){},e24e:function(e,t,a){"use strict";a("e826")},e826:function(e,t,a){},eeef:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));a("0721"),a("7fa7"),a("042e"),a("c189"),a("3435");var r={methods:{saveFile:function(e,t){var a=window.URL.createObjectURL(new Blob([t])),r=document.createElement("a");r.href=a,r.setAttribute("download",e),document.body.appendChild(r),r.click()}}}},f778:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));a("5cf2"),a("0721"),a("ac30"),a("f6a5"),a("8281");var r={methods:{filterEmpty:function(e){if(void 0==e)return"";if(Array.isArray(e)){var t=e.join(" ").split(" ").filter((function(e){return e}));return t}return e}}}}}]);
//# sourceMappingURL=chunk-61cfb7d2.fc4f00d3.js.map