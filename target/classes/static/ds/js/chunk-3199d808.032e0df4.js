(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3199d808"],{"10f4":function(e,t,a){},"4b1f":function(e,t,a){"use strict";a("b253")},"604e":function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var r=a("b775"),o=a("bc3a"),s=a.n(o);const n={encrypt:function({userName:e,tags:t,file:a,policy:o,uploader:s}){const n=new FormData;return n.append("fileName",e),n.append("file",a),n.append("tags",t),n.append("policy",o),n.append("uploader",s),new Promise((e,t)=>{Object(r["a"])({url:"/content/upload",method:"post",headers:{"Content-Type":"multipart/form-data"},data:n,timeout:0}).then(a=>{200===a.code?e(a.data):t(a)}).catch(t)})},files:function({userName:e,tag:t,size:a,bookmark:o}){const s={userName:e,tag:t,size:a,bookmark:o},n={fromUserName:s.userName,tag:s.tag,pageSize:s.size||10,bookmark:s.bookmark};return new Promise((e,t)=>{Object(r["a"])({url:"/content/list",method:"get",data:n,params:n}).then(a=>{200===a.code?e(a.data):t(a)}).catch(t)})},decrypt:function({user:e,cipher:t,sharedUser:a,fileName:o,tags:s}){const n={userName:e,fileName:o,cipher:t,tags:s,sharedUser:a};return new Promise((e,t)=>{Object(r["a"])({url:"/content/decryption",method:"post",data:n}).then(a=>{200===a.code?e(a.data):t(a)}).catch(t)})},download:function({fileName:e,sharedUser:t}){const a={fileName:e,sharedUser:t};return new Promise((e,t)=>{s.a.request({baseURL:"/abe/",url:"/content/download",method:"get",data:a,params:a,responseType:"blob"}).then(a=>{200===a.status?e(a.data):t(a)}).catch(t)})},downloadCipher:function({userName:e,fileName:t,sharedUser:a}){const r={userName:e,fileName:t,sharedUser:a};return new Promise((e,t)=>{s.a.request({baseURL:"/abe/",url:"/content/cipher",method:"get",data:r,params:r,responseType:"blob"}).then(a=>{200===a.status?e(a.data):t(a)}).catch(t)})},verifySignature:function({userName:e,fileName:t,sharedUser:a}){const o={userName:e,fileName:t,sharedUser:a};return new Promise((e,t)=>{Object(r["a"])({url:"/content/verify",method:"post",data:o,params:o}).then(a=>{200===a.code?e(a.data):t(a)}).catch(t)})}}},"6b79":function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));const r={methods:{formatTime(e){let t="-";try{t=new Date(1e3*e);var a=t.getFullYear(),r=t.getMonth()+1,o=t.getDate(),s=t.getHours(),n=t.getMinutes(),l=t.getSeconds(),i=`${a}-${r}-${o} ${s}:${n}:${l}`;return i}catch(c){console.log(c)}return t}}}},"752a":function(e,t,a){"use strict";var r=function(){var e=this,t=e._self._c;return t("el-table",{attrs:{data:e.files}},[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"文件名",prop:"fileName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"密文哈希",prop:"cipher"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"上传者",prop:"sharedUser"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"上传时间",prop:"timeStamp",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.timeStamp)+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"加密策略",prop:"policy"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"标签",prop:"tags"},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(e.filterEmpty(a.row.tags),(function(a,r){return t("el-tag",{key:r,attrs:{size:"small",effect:"plain"}},[e._v(" "+e._s(a)+" ")])}))}}])}),t("el-table-column",{attrs:{label:"操作",align:"right",width:"300"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.verifySignature(a.row)}}},[e._v(" 验签 ")]),t("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.decryDownload(a.row)}}},[e._v(" 解密下载 ")]),t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.cipherDownload(a.row)}}},[e._v(" 下载密文 ")])]}}])})],1)},o=[],s=a("604e"),n=a("07a4"),l=a("eeef"),i=a("f778"),c=a("6b79"),u=a("5c96"),d={name:"FilesTable",mixins:[l["a"],i["a"],c["a"]],props:{files:{type:Array,default:void 0}},methods:{decryDownload(e){const t=n["a"].userName(),{cipher:a,sharedUser:r,fileName:o,tags:l}=e;s["a"].decrypt({user:t,cipher:a,sharedUser:r,fileName:o,tags:l}).then(()=>s["a"].download({fileName:o,sharedUser:r}).then(e=>{this.saveFile(o,e)}).catch(e=>{this.$message({message:e.message,duration:5e3,type:"error"})})).catch(e=>{this.$message({message:e.message,duration:5e3,type:"error"})})},cipherDownload(e){const t=n["a"].userName(),{sharedUser:a,fileName:r}=e;s["a"].downloadCipher({userName:t,fileName:r,sharedUser:a}).then(e=>{this.saveFile("cipher_hash_"+r,e)}).catch(e=>{this.$message({message:e.message,duration:5e3,type:"error"})})},verifySignature(e){const t=n["a"].userName(),{sharedUser:a,fileName:r}=e;s["a"].verifySignature({userName:t,fileName:r,sharedUser:a}).then(e=>{Object(u["Message"])({message:"验签通过",duration:5e3,type:"success"}),console.log(e)}).catch(e=>{Object(u["Message"])({message:e.message,duration:5e3,type:"error"})})}}},m=d,f=(a("d9dd"),a("2877")),p=Object(f["a"])(m,r,o,!1,null,"724759ab",null);t["a"]=p.exports},8589:function(e,t,a){"use strict";a("92b7")},"92b7":function(e,t,a){},"9ec5":function(e,t,a){"use strict";a("f6ae")},ae8d:function(e,t,a){"use strict";var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"card"},[e.title?t("div",{staticClass:"card-head"},[e._v(" "+e._s(e.title)+" "),t("div",{staticStyle:{float:"right"}},[e._t("op")],2)]):e._e(),e._t("default")],2)},o=[],s={name:"Card",props:{title:{type:String,default:""}}},n=s,l=(a("b581"),a("2877")),i=Object(l["a"])(n,r,o,!1,null,"88a16ad0",null);t["a"]=i.exports},b253:function(e,t,a){},b581:function(e,t,a){"use strict";a("f619")},c4b0:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("transition-group",{staticClass:"grid-rows",attrs:{tag:"div",appear:""},on:{"before-enter":e.beforeEnter,enter:e.animEnter}},[t("Mine",{key:"0",attrs:{"data-index":"0.3"}}),t("Upload",{key:"1",attrs:{"data-index":"0"}})],1)},o=[],s=function(){var e=this,t=e._self._c;return t("Card",{attrs:{title:"我的文件"}},[t("FilesTable",{attrs:{files:e.files}})],1)},n=[],l=a("ae8d"),i=a("752a"),c=a("604e"),u=a("07a4"),d=a("eeef"),m=a("f778"),f={name:"Mine",mixins:[d["a"],m["a"]],components:{Card:l["a"],FilesTable:i["a"]},data(){return{files:[],bookmark:""}},mounted(){const e="",t=u["a"].userName(),{bookmark:a}=this;c["a"].files({userName:t,tag:e,bookmark:a}).then(e=>{this.files=e.contents,this.bookmark=e.bookmark}).catch(console.log)}},p=f,h=(a("8589"),a("2877")),b=Object(h["a"])(p,s,n,!1,null,"39e264c4",null),g=b.exports,y=function(){var e=this,t=e._self._c;return t("Card",{attrs:{title:"上传文件"}},[t("div",{staticClass:"grid-cols"},[t("el-form",{ref:"uploadForm",attrs:{"label-position":"left",rules:e.uploadRules,model:e.form,"label-width":"100px"}},[t("el-form-item",{attrs:{prop:"file",label:"* 选择文件"}},[t("input",{attrs:{type:"file",id:"input-file"}})]),t("el-form-item",{attrs:{prop:"policy",label:"策略表达式"}},[t("el-input",{attrs:{placeholder:"(A AND B AND (C OR D))"},model:{value:e.form.policy,callback:function(t){e.$set(e.form,"policy",t)},expression:"form.policy"}})],1),t("el-form-item",{attrs:{prop:"tags",label:"标签"}},[t("el-input",{attrs:{placeholder:"城市 系统 业务 备注（空格隔开）"},model:{value:e.form.tags,callback:function(t){e.$set(e.form,"tags",t)},expression:"form.tags"}})],1),t("el-form-item",{attrs:{prop:"uploader",label:"上传者"}},[t("el-select",{attrs:{placeholder:"请选择",size:"middle"},on:{change:e.selectMethod},model:{value:e.form.uploader,callback:function(t){e.$set(e.form,"uploader",t)},expression:"form.uploader"}},e._l(e.Uploaderoptions,(function(e,a){return t("el-option",{key:a,attrs:{label:e,value:e}})})),1)],1),"组织"==e.form.uploader?t("el-form-item",{attrs:{prop:"org",label:"上传组织"}},[t("el-input",{attrs:{placeholder:"组织名"},model:{value:e.form.org,callback:function(t){e.$set(e.form,"org",t)},expression:"form.org"}})],1):e._e(),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.upload}},[e._v("上传到服务器")])],1)],1)],1)])},w=[],v=a("5c96"),N={name:"Upload",components:{Card:l["a"]},data(){return{form:{tags:"",policy:"",uploader:"",org:""},options:["shanghai","myc","edu","test"],Uploaderoptions:["用户","组织"],uploadRules:{policy:[{required:!0,trigger:"blur",message:"请填写上传策略"}],tags:[{required:!0,trigger:"blur",message:"请设置标签"}],uploader:[{required:!0,trigger:"blur",message:"请设置上传者"}],org:[{required:!0,trigger:"blur",message:"请设置上传组织"}]}}},watch:{},async mounted(){},methods:{selecedFile(e){this.file=e.file},handleRemove(e){this.$refs.upload.abort(e)},selectMethod(e){this.uploader=e},upload(){const e=document.querySelector("input[type=file]").files[0];if(console.log(e),!e)return void v["Notification"].error({title:"拒绝",message:"请添加文件",duration:2e3});let t=this.form.tags.split(" ");t.length<3?v["Notification"].error({title:"拒绝",message:"请补充完整的标签",duration:2e3}):this.$refs.uploadForm.validate(a=>{if(!a)return;const r=u["a"].userName(),o=this.form.policy;var s="";s="用户"==this.form.uploader?u["a"].userName():this.form.org,c["a"].encrypt({file:e,userName:r,tags:t,policy:o,uploader:s}).then(e=>{Object(v["Message"])({message:"上传成功",duration:5e3,type:"success"}),console.log(e)}).catch(e=>{Object(v["Message"])({message:e.message,duration:5e3,type:"error"})})})}}},k=N,_=(a("9ec5"),Object(h["a"])(k,y,w,!1,null,"61af24b8",null)),U=_.exports,x={name:"Files",components:{Mine:g,Upload:U},methods:{beforeEnter:function(e){e.dataset.index>-1&&(e.style.opacity=.5,e.style.transform="translateX(30px)")},animEnter:function(e,t){var a=250*e.dataset.index;setTimeout((function(){e.style="",t()}),a)}}},j=x,O=(a("4b1f"),Object(h["a"])(j,r,o,!1,null,"f30e4408",null));t["default"]=O.exports},d9dd:function(e,t,a){"use strict";a("10f4")},eeef:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));const r={methods:{saveFile(e,t){const a=window.URL.createObjectURL(new Blob([t])),r=document.createElement("a");r.href=a,r.setAttribute("download",e),document.body.appendChild(r),r.click()}}}},f619:function(e,t,a){},f6ae:function(e,t,a){},f778:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));const r={methods:{filterEmpty(e){if(void 0==e)return"";if(Array.isArray(e)){let t=e.join(" ").split(" ").filter(e=>e);return t}return e}}}}}]);
//# sourceMappingURL=chunk-3199d808.032e0df4.js.map