(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-871fe4fe"],{"14d9":function(e,t,r){"use strict";var a=r("23e7"),o=r("7b0b"),n=r("07fa"),s=r("3a34"),i=r("3511"),l=r("d039"),m=l((function(){return 4294967297!==[].push.call({length:4294967296},1)})),c=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}},u=m||!c();a({target:"Array",proto:!0,arity:1,forced:u},{push:function(e){var t=o(this),r=n(t),a=arguments.length;i(r+a);for(var l=0;l<a;l++)t[r]=arguments[l],r++;return s(t,r),r}})},"2a32":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var a=r("b775");const o={create:function(e){const t={fileName:e.userName,t:e.threshold,n:e.usersNum,users:e.users,orgName:e.orgName};return new Promise((e,r)=>{Object(a["a"])({url:"/org/apply/creation",method:"post",data:t}).then(t=>{200===t.code?e(t.data):r(t)}).catch(r)})},join:function({userName:e,orgName:t}){const r={fileName:e,orgName:t};return new Promise((e,t)=>{Object(a["a"])({url:"/org/apply/creation/approval",method:"post",data:r}).then(r=>{200===r.code?e(r.data):t(r)}).catch(t)})},submitppk:function({orgName:e,userName:t}){const r={type:"CREATION",orgName:e,fileName:t,attrName:""};return new Promise((e,t)=>{Object(a["a"])({url:"/org/part-pk",method:"post",params:r}).then(r=>{200===r.code?e(r.data):t(r)}).catch(t)})},submitOrgAttppk:function({orgName:e,userName:t,attrName:r}){const o={type:"ATTRIBUTE",orgName:e,fileName:t,attrName:r};return new Promise((e,t)=>{Object(a["a"])({url:"/org/part-pk",method:"post",params:o}).then(r=>{200===r.code?e(r.data):t(r)}).catch(t)})},completeOrg:function({orgName:e,userName:t}){const r={type:"CREATION",orgName:e,userName:t,attrName:""};return this.complete(r)},completeOrgAttr:function({orgName:e,userName:t,attrName:r}){return this.complete({type:"ATTRIBUTE",orgName:e,userName:t,attrName:r})},complete:function({type:e,orgName:t,userName:r,attrName:o}){const n={type:e,orgName:t,fileName:r,attrName:o};return new Promise((e,t)=>{Object(a["a"])({url:"/org/complete-pk",method:"post",params:n}).then(r=>{200===r.code?e(r.data):t(r)}).catch(t)})},tempOrgInfo:function({orgName:e}){const t={type:"CREATION",orgName:e,attrName:""};return new Promise((e,r)=>{Object(a["a"])({url:"/org/apply",method:"get",params:t}).then(t=>{200===t.code?e(t.data):r(t)}).catch(e=>{e?console.log(e):r(e)})})},tempOrgAttrInfo:function({orgName:e,attrName:t}){const r={type:"ATTRIBUTE",orgName:e,attrName:t};return new Promise((e,t)=>{Object(a["a"])({url:"/org/apply",method:"get",params:r}).then(r=>{200===r.code?e(r.data):t(r)}).catch(e=>{e?console.log(e):t(e)})})},detailInfo:function({orgName:e}){const t={orgName:e};return new Promise((e,r)=>{Object(a["a"])({url:"/org/",method:"get",params:t}).then(t=>{200===t.code?e(t.data):r(t)}).catch(r)})},declareAttr:function({orgName:e,userName:t,attrName:r}){const o={orgName:e,fileName:t,attrName:r};return new Promise((e,t)=>{Object(a["a"])({url:"/org/apply/attribute",method:"post",data:o}).then(r=>{200===r.code?e(r.data):t(r)}).catch(t)})},approvalAttr:function({userName:e,orgName:t,attrName:r}){const o={fileName:e,orgName:t,attrName:r};return new Promise((e,t)=>{Object(a["a"])({url:"/org/apply/attribute/approval",method:"post",data:o}).then(r=>{200===r.code?e(r.data):t(r)}).catch(t)})}}},3511:function(e,t){var r=TypeError,a=9007199254740991;e.exports=function(e){if(e>a)throw r("Maximum allowed index exceeded");return e}},"3a34":function(e,t,r){"use strict";var a=r("83ab"),o=r("e8b5"),n=TypeError,s=Object.getOwnPropertyDescriptor,i=a&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=i?function(e,t){if(o(e)&&!s(e,"length").writable)throw n("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},"3f04":function(e,t,r){},"477a":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;return t("transition-group",{staticClass:"grid-rows",attrs:{tag:"div",appear:""},on:{"before-enter":e.beforeEnter,enter:e.animEnter}},[t("Mine",{key:"0",attrs:{"data-index":"0"}})],1)},o=[],n=function(){var e=this,t=e._self._c;return t("div",[t("Card",{attrs:{title:"我的组织"},scopedSlots:e._u([{key:"op",fn:function(){return[t("el-button",{attrs:{size:"small"},on:{click:function(t){e.joinDialogFormVisible=!0}}},[e._v(" 加入组织 ")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){e.applyDialogFormVisible=!0}}},[e._v(" 申请创建组织 ")])]},proxy:!0}])},[e.OPKMap?t("div",[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.formatOrganization(e.OPKMap)}},[t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"name",label:"组织名称",width:"180"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"value",label:"组织公钥"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.value||"暂无")+" ")]}}],null,!1,508938292)}),t("el-table-column",{attrs:{label:"操作",width:"160",align:"right"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.submitPartPK(r.row)}}},[e._v(" 提交组织秘密 ")])]}}],null,!1,3126450051)})],1)],1):t("el-empty",{attrs:{"image-size":100,description:"没有正在申请的属性"}})],1),t("el-dialog",{attrs:{title:"申请成立新组织",visible:e.applyDialogFormVisible},on:{"update:visible":function(t){e.applyDialogFormVisible=t}}},[t("el-form",{ref:"applyForm",attrs:{rules:e.applyRules,model:e.form,"label-width":"80px"}},[t("el-form-item",{attrs:{prop:"orgName",label:"组织名称"}},[t("el-input",{attrs:{placeholder:"请输入组织名称"},model:{value:e.form.orgName,callback:function(t){e.$set(e.form,"orgName",t)},expression:"form.orgName"}})],1),t("el-form-item",{attrs:{prop:"threshold",label:"阈值"}},[t("el-input",{attrs:{placeholder:"请输入阈值"},model:{value:e.form.threshold,callback:function(t){e.$set(e.form,"threshold",t)},expression:"form.threshold"}})],1),t("el-form-item",{attrs:{prop:"userStr",label:"其它成员"}},[t("el-input",{attrs:{placeholder:"请输入除您之外包含的其它成员"},model:{value:e.form.userStr,callback:function(t){e.$set(e.form,"userStr",t)},expression:"form.userStr"}})],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.applyDialogFormVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.applyForOrg}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"加入组织",visible:e.joinDialogFormVisible},on:{"update:visible":function(t){e.joinDialogFormVisible=t}}},[t("el-form",{ref:"joinForm",attrs:{rules:e.joinRules,model:e.joinForm,"label-width":"80px"}},[t("el-form-item",{attrs:{prop:"orgName",label:"组织名称"}},[t("el-input",{attrs:{placeholder:"请输入组织名称"},model:{value:e.joinForm.orgName,callback:function(t){e.$set(e.joinForm,"orgName",t)},expression:"joinForm.orgName"}})],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.joinDialogFormVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.joinOrg}},[e._v("确 定")])],1)],1)],1)},s=[],i=(r("14d9"),r("ae8d")),l=r("2a32"),m=r("07a4"),c={name:"Mine",components:{Card:i["a"]},computed:{...m["a"].mapUser(["OPKMap"])},data(){return{applyDialogFormVisible:!1,form:{threshold:"",userStr:"",orgName:""},applyRules:{orgName:[{required:!0,trigger:"blur",message:"组织名不能为空"}],threshold:[{required:!0,trigger:"blur",message:"阈值不能为空"}],userStr:[{required:!0,trigger:"blur",message:"成员不能为空"}]},joinDialogFormVisible:!1,joinForm:{orgName:""},joinRules:{orgName:[{required:!0,trigger:"blur",message:"组织名不能为空"}]}}},methods:{formatOrganization(e){let t=[];for(let r of Object.keys(e))t.push({name:r,value:e[r].OPK});return t},applyForOrg(){const e=m["a"].userName();e&&this.$refs.applyForm.validate(t=>{if(!t)return;const{threshold:r,userStr:a,orgName:o}=this.form,n=a.split(" ");n.push(e),l["a"].create({userName:e,threshold:r,users:n,orgName:o,usersNum:n.length}).then(()=>{this.$message({message:"申请成功",duration:2e3,type:"success"})}).catch(e=>{this.$message({message:e.message,type:"error"})}).finally(()=>{this.applyDialogFormVisible=!1})})},joinOrg(){const e=m["a"].userName();e&&this.$refs.joinForm.validate(t=>{if(!t)return;const{orgName:r}=this.joinForm;l["a"].join({userName:e,orgName:r}).then(()=>{this.$message({message:"加入成功",duration:2e3,type:"success"})}).catch(e=>{this.$message({message:e.message,type:"error"})}).finally(()=>{this.applyDialogFormVisible=!1})})},submitPartPK(e){const t=m["a"].userName();l["a"].submitppk({userName:t,orgName:e.name}).then(()=>{this.$message({message:"提交成功",duration:2e3,type:"success"}),this.trycompleteOrgPK(t,e.name)}).catch(e=>{this.$message({message:e.message,type:"error"})})},trycompleteOrgPK(e,t){l["a"].completeOrg({userName:e,orgName:t}).then(()=>{this.$message({message:"组织已确认创建",duration:2e3,type:"success"})}).catch(console.log)}}},u=c,p=r("2877"),g=Object(p["a"])(u,n,s,!1,null,null,null),f=g.exports,d={name:"Organizations",components:{Mine:f},data(){return{attributes:[]}},methods:{beforeEnter:function(e){e.dataset.index>-1&&(e.style.opacity=.5,e.style.transform="translateX(30px)")},animEnter:function(e,t){var r=250*e.dataset.index;setTimeout((function(){e.style="",t()}),r)}}},h=d,b=(r("9340"),Object(p["a"])(h,a,o,!1,null,"7108c15b",null));t["default"]=b.exports},9340:function(e,t,r){"use strict";r("3f04")},ae8d:function(e,t,r){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"card"},[e.title?t("div",{staticClass:"card-head"},[e._v(" "+e._s(e.title)+" "),t("div",{staticStyle:{float:"right"}},[e._t("op")],2)]):e._e(),e._t("default")],2)},o=[],n={name:"Card",props:{title:{type:String,default:""}}},s=n,i=(r("b581"),r("2877")),l=Object(i["a"])(s,a,o,!1,null,"88a16ad0",null);t["a"]=l.exports},b581:function(e,t,r){"use strict";r("f619")},e8b5:function(e,t,r){var a=r("c6b6");e.exports=Array.isArray||function(e){return"Array"==a(e)}},f619:function(e,t,r){}}]);
//# sourceMappingURL=chunk-871fe4fe.e3d1c027.js.map