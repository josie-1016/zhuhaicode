(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-79f17baa"],{"2a32":function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));a("0721");var r=a("b775"),n={create:function(e){var t={fileName:e.userName,t:e.threshold,n:e.usersNum,users:e.users,orgName:e.orgName};return new Promise((function(e,a){Object(r["a"])({url:"/org/apply/creation",method:"post",data:t}).then((function(t){200===t.code?e(t.data):a(t)})).catch(a)}))},join:function(e){var t=e.userName,a=e.orgName,n={fileName:t,orgName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply/creation/approval",method:"post",data:n}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},submitppk:function(e){var t=e.orgName,a=e.userName,n={type:"CREATION",orgName:t,fileName:a,attrName:""};return new Promise((function(e,t){Object(r["a"])({url:"/org/part-pk",method:"post",params:n}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},submitOrgAttppk:function(e){var t=e.orgName,a=e.userName,n=e.attrName,o={type:"ATTRIBUTE",orgName:t,fileName:a,attrName:n};return new Promise((function(e,t){Object(r["a"])({url:"/org/part-pk",method:"post",params:o}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},completeOrg:function(e){var t=e.orgName,a=e.userName,r={type:"CREATION",orgName:t,userName:a,attrName:""};return this.complete(r)},completeOrgAttr:function(e){var t=e.orgName,a=e.userName,r=e.attrName;return this.complete({type:"ATTRIBUTE",orgName:t,userName:a,attrName:r})},complete:function(e){var t=e.type,a=e.orgName,n=e.userName,o=e.attrName,s={type:t,orgName:a,fileName:n,attrName:o};return new Promise((function(e,t){Object(r["a"])({url:"/org/complete-pk",method:"post",params:s}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},tempOrgInfo:function(e){var t=e.orgName,a={type:"CREATION",orgName:t,attrName:""};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply",method:"get",params:a}).then((function(a){200===a.code?e(a.data):t(a)})).catch((function(e){e?console.log(e):t(e)}))}))},tempOrgAttrInfo:function(e){var t=e.orgName,a=e.attrName,n={type:"ATTRIBUTE",orgName:t,attrName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply",method:"get",params:n}).then((function(a){200===a.code?e(a.data):t(a)})).catch((function(e){e?console.log(e):t(e)}))}))},detailInfo:function(e){var t=e.orgName,a={orgName:t};return new Promise((function(e,t){Object(r["a"])({url:"/org/",method:"get",params:a}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},declareAttr:function(e){var t=e.orgName,a=e.userName,n=e.attrName,o={orgName:t,fileName:a,attrName:n};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply/attribute",method:"post",data:o}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},approvalAttr:function(e){var t=e.userName,a=e.orgName,n=e.attrName,o={fileName:t,orgName:a,attrName:n};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply/attribute/approval",method:"post",data:o}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))}}},5897:function(e,t,a){"use strict";a("6b52")},"6b52":function(e,t,a){},"6b79":function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));a("106c");var r={methods:{formatTime:function(e){if(""===e)return"";var t="-";try{t=new Date(1e3*e);var a=t.getFullYear(),r=t.getMonth()+1,n=t.getDate(),o=t.getHours(),s=t.getMinutes(),i=t.getSeconds(),l="".concat(a,"-").concat(r,"-").concat(n," ").concat(o,":").concat(s,":").concat(i);return l}catch(c){console.log(c)}return t}}}},9351:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));a("0721");var r=a("b775"),n=a("4f14"),o=a.n(n),s={encryptThreshold:function(e){var t=e.file,a=e.org,n=new FormData;return n.append("file",t),n.append("orgName",a),new Promise((function(e,t){Object(r["a"])({url:"/content/thresholdUpload",method:"post",headers:{"Content-Type":"multipart/form-data"},data:n,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},orgSearchThreshold:function(e){var t=e.orgName,a=e.fileName,n=e.fromUid,o={orgName:t,fileName:a,fromUid:n};return new Promise((function(e,t){Object(r["a"])({url:"/content/threshold/orgList",method:"get",headers:{"Content-Type":"multipart/form-data"},params:o,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},searchThreshold:function(e){var t=e.orgName,a=e.fileName,n={orgName:t,fileName:a},o={orgName:n.orgName,fileName:n.fileName};return new Promise((function(e,t){Object(r["a"])({url:"/content/threshold/list",method:"get",headers:{"Content-Type":"multipart/form-data"},params:o,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},approvalThreshold:function(e){var t=e.userName,a=e.org,n=e.fileName,o=e.fromUid,s={orgName:a,fileName:n,uid:t,fromUid:o};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply/ThresholdFile/approval",method:"post",headers:{"Content-Type":"multipart/form-data"},params:s,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},applyThresholdOrgPartSk:function(e){var t=e.orgName,a=e.uid,n={orgName:t,userName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/threshold/apply-part-sk",method:"post",params:n,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},approveThresholdOrgPartSk:function(e){var t=e.orgName,a=e.uid,n={orgName:t,userName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/threshold/approve-part-sk",method:"post",params:n,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},completeThresholdOrgPartSk:function(e){var t=e.orgName,a=e.uid,n={orgName:t,userName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/Threshold/complete-pk",method:"post",params:n,timeout:0}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},tryApplyThresholdFile:function(e){var t=e.orgName,a=e.user,n=e.fileName,o={orgName:t,fileName:n,userName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply/threshold",method:"post",data:o}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},decrypt:function(e){var t=e.orgName,a=e.userName,n=e.fileName,o={userName:a,orgName:t,fileName:n};return console.log(o),new Promise((function(e,t){Object(r["a"])({url:"/content/thresholdDecrypt",method:"get",params:o}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},download:function(e){var t=e.fileName,a=e.orgName,r={fileName:t,orgName:a};return new Promise((function(e,t){o.a.request({baseURL:"/abe/",url:"/content/thresholdDownload",method:"get",data:r,params:r,responseType:"blob"}).then((function(a){200===a.status?e(a.data):t(a)})).catch(t)}))}}},a344:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition-group",{staticClass:"grid-rows",attrs:{tag:"div",appear:""},on:{"before-enter":e.beforeEnter,enter:e.animEnter,leave:e.animLeave}},[a("Mine",{key:"0",attrs:{"data-index":"0",info:e.info}}),a("Members",{key:"3",attrs:{"data-index":"0.3",info:e.info}}),e.success?[a("Attributes",{key:"5",attrs:{"data-index":"0.5",info:e.info}}),a("Search",{key:"4",attrs:{"data-index":"0.5",info:e.info}})]:e._e(),a("ThresholdSearch",{key:"6",attrs:{"data-index":"0.5",info:e.info}})],2)},n=[],o=a("cc39"),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Card",{attrs:{title:"组织信息"}},[e.info?a("el-descriptions",{attrs:{column:3}},[a("el-descriptions-item",{attrs:{label:"组织名称"}},[e._v(e._s(e.info.orgId))]),a("el-descriptions-item",{attrs:{label:"成员总数"}},[e._v(e._s(e.info.n))]),a("el-descriptions-item",{attrs:{label:"阈值"}},[e._v(e._s(e.info.t))]),a("el-descriptions-item",{attrs:{label:"创建时间"}},[e._v(" "+e._s(e.formatTime(e.info.createTime))+" ")]),a("el-descriptions-item",{attrs:{label:"创建人"}},[e._v(e._s(e.info.fromUserName))]),a("el-descriptions-item",{attrs:{label:"状态"}},[e._v(e._s(e.info.status))]),e.info.opk?a("el-descriptions-item",{attrs:{label:"组织公钥"}},[e._v(e._s(e.info.opk))]):e._e()],1):e._e()],1)},i=[],l=a("ae8d"),c=a("6b79"),u={name:"Mine",mixins:[c["a"]],components:{Card:l["a"]},props:{info:{orgId:"",t:"",n:"",createTime:"",fromUserName:"",status:""}}},m=u,f=a("52e0"),p=Object(f["a"])(m,s,i,!1,null,null,null),d=p.exports,h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Card",{attrs:{title:"属性搜索"},scopedSlots:e._u([{key:"op",fn:function(){return[a("el-input",{attrs:{size:"medium",placeholder:"请输入要搜索的属性"},model:{value:e.newAttr,callback:function(t){e.newAttr=t},expression:"newAttr"}},[a("el-button",{attrs:{slot:"append"},on:{click:e.searchAttr},slot:"append"},[e._v("搜索")])],1)]},proxy:!0}])},[e.attr?a("div",[a("el-table",{attrs:{data:[e.attr]}},[a("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"属性名",prop:"attrName"}}),a("el-table-column",{attrs:{label:"申请时间",prop:"createTime",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatTime(t.row.createTime))+" ")]}}],null,!1,4062287963)}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"申请人",prop:"fromUserName"}}),a("el-table-column",{attrs:{label:"状态",prop:"status",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{size:"small",effect:"plain"}},[e._v(" "+e._s(t.row.status)+" ")])]}}],null,!1,2069180677)}),a("el-table-column",{attrs:{label:"操作",width:"300",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.submitPartPK(t.row)}}},[e._v(" 提交属性秘密 ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.agreeAttr(t.row)}}},[e._v(" 同意 ")])]}}],null,!1,49948825)})],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.members(e.attr)}},[a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"name",label:"小组成员"}}),a("el-table-column",{attrs:{prop:"value",label:"是否同意该属性",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.statusTypes[t.row.value]}},[e._v(" "+e._s(t.row.value?"已同意":"未响应")+" ")])]}}],null,!1,1495289878)})],1)],1):a("el-empty")],1)},g=[],N=(a("106c"),a("1a55"),a("07a4")),v=a("2a32"),b={name:"Search",mixins:[c["a"]],components:{Card:l["a"]},props:{info:{}},data:function(){return{newAttr:"",attr:!1,statusTypes:{true:"success",false:"danger"}}},methods:{searchAttr:function(){var e=this;this.attr=!1;var t=this.info.orgId,a="".concat(t,":").concat(this.newAttr);v["a"].tempOrgAttrInfo({orgName:t,attrName:a}).then((function(t){t?e.attr=t:e.$message({message:"没有该属性",type:"info"})})).catch((function(t){e.$message({message:t.message,type:"error"})}))},submitPartPK:function(e){var t=this,a=N["a"].userName(),r=this.info.orgId,n=e.attrName;v["a"].submitOrgAttppk({userName:a,attrName:n,orgName:r}).then((function(){t.$message({message:"提交成功",duration:2e3,type:"success"}),t.trycompleteOrgPK(a,r,n)})).catch((function(e){t.$message({message:e.message,type:"error"})}))},trycompleteOrgPK:function(e,t,a){var r=this;v["a"].completeOrgAttr({userName:e,orgName:t,attrName:a}).then((function(){r.$message({message:"组织属性已确认创建",duration:2e3,type:"success"})})).catch(console.log)},agreeAttr:function(e){var t=this,a=N["a"].userName(),r=this.info.orgId,n=e.attrName;v["a"].approvalAttr({userName:a,orgName:r,attrName:n}).then((function(){t.searchAttr(),t.$message({message:"提交成功",duration:2e3,type:"success"})})).catch((function(e){t.$message({message:e.message,type:"error"})}))},members:function(e){if(void 0==e)return[];var t=e.uidMap;if(void 0==t)return[];for(var a=[],r=0,n=Object.keys(t);r<n.length;r++){var o=n[r];a.push({name:o,value:t[o]})}return a}}},y=b,w=Object(f["a"])(y,h,g,!1,null,null,null),_=w.exports,O=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Card",{attrs:{title:"组织成员"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.members(e.info)}},[a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"name",label:"名称"}}),a("el-table-column",{attrs:{prop:"value",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.statusTypes[t.row.value]}},[e._v(" "+e._s(t.row.value?"已接受":"未响应")+" ")])]}}])})],1)],1)},k=[],T={name:"Members",components:{Card:l["a"]},props:{info:{uidMap:{}}},data:function(){return{statusTypes:{true:"success",false:"danger"}}},methods:{members:function(e){if(void 0==e)return[];var t=e.uidMap;if(void 0==t)return[];for(var a=[],r=0,n=Object.keys(t);r<n.length;r++){var o=n[r];a.push({name:o,value:t[o]})}return a}}},A=T,P=Object(f["a"])(A,O,k,!1,null,null,null),j=P.exports,S=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Card",{attrs:{title:"组织属性"},scopedSlots:e._u([{key:"op",fn:function(){return[a("el-input",{attrs:{size:"medium",placeholder:"请输入要声明的属性"},model:{value:e.newAttr,callback:function(t){e.newAttr=t},expression:"newAttr"}},[a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{slot:"append"},on:{click:e.generateAttr},slot:"append"},[e._v("声明新属性")])],1)]},proxy:!0}])},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.getAttributes(e.info)}},[a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"name",label:"属性名"}})],1)],1)},x=[],$=(a("0721"),{name:"Attributes",components:{Card:l["a"]},props:{info:{}},data:function(){return{newAttr:"",fullscreenLoading:!1}},methods:{getAttributes:function(e){if(void 0==e)return[];var t=e.attributes;if(void 0!=t){for(var a=[],r=0,n=Object.keys(t);r<n.length;r++){var o=n[r];a.push({name:t[o]})}return a}},generateAttr:function(){var e=this,t=N["a"].userName(),a=this.info.orgId,r="".concat(a,":").concat(this.newAttr);this.fullscreenLoading=!0,v["a"].declareAttr({userName:t,orgName:a,attrName:r}).then((function(){e.fullscreenLoading=!1,e.$message({message:"创建成功",duration:2e3,type:"success"})})).catch((function(t){e.fullscreenLoading=!1,e.$message({message:t.message,type:"error"})})).finally((function(){e.newAttr=""}))}}}),C=$,I=Object(f["a"])(C,S,x,!1,null,null,null),U=I.exports,E=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Card",{attrs:{title:"门限搜索"}},[a("div",{staticStyle:{"margin-bottom":"15px"}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{size:"medium",placeholder:"请输入要搜索的用户"},model:{value:e.newUser,callback:function(t){e.newUser=t},expression:"newUser"}})],1),a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{size:"medium",placeholder:"请输入要搜索的文件"},model:{value:e.newfile,callback:function(t){e.newfile=t},expression:"newfile"}})],1),a("el-col",{attrs:{span:2}},[a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:e.searchFile}},[e._v("搜索")])],1)],1)],1),e.attr?a("div",[a("el-table",{attrs:{data:[e.attr]}},[a("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"文件名",prop:"fileName"}}),a("el-table-column",{attrs:{label:"申请时间",prop:"createTime",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatTime(t.row.createTime))+" ")]}}],null,!1,4062287963)}),a("el-table-column",{attrs:{label:"申请人",prop:"applyPerson",width:"160"}}),a("el-table-column",{attrs:{label:"状态",prop:"status",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{size:"small",effect:"plain"}},[e._v(" "+e._s(t.row.status)+" ")])]}}],null,!1,2069180677)}),a("el-table-column",{attrs:{label:"操作",width:"300",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.agreeFile(t.row)}}},[e._v(" 同意 ")])]}}],null,!1,2398961825)})],1)],1):a("el-empty")],1)},M=[],z=a("9351"),L={name:"ThresholdSearch",mixins:[c["a"]],components:{Card:l["a"]},props:{info:{}},data:function(){return{newUser:"",newfile:"",attr:"",statusTypes:{true:"success",false:"danger"}}},methods:{searchFile:function(){var e=this,t=this.info.orgId,a=N["a"].userName(),r=this.newfile,n=this.newUser;console.log(t,a,r,n),console.log("111111111111111111111111111111111111111111"),z["a"].orgSearchThreshold({orgName:t,fileName:r,fromUid:n}).then((function(t){console.log(t),e.attr={fileName:r,applyPerson:n,status:"未解密",createTime:t}})).catch((function(t){e.$message({message:t.message,type:"error"})}))},submitPartPK:function(e){var t=this,a=N["a"].userName(),r=this.info.orgId,n=e.attrName;v["a"].submitOrgAttppk({userName:a,attrName:n,orgName:r}).then((function(){t.$message({message:"提交成功",duration:2e3,type:"success"}),t.trycompleteOrgPK(a,r,n)})).catch((function(e){t.$message({message:e.message,type:"error"})}))},trycompleteOrgPK:function(e,t,a){var r=this;v["a"].completeOrgAttr({userName:e,orgName:t,attrName:a}).then((function(){r.$message({message:"组织属性已确认创建",duration:2e3,type:"success"})})).catch(console.log)},agreeFile:function(e){var t=this,a=N["a"].userName(),r=this.info.orgId,n=e.fileName,o=e.applyPerson;console.log(a,r,n,o),z["a"].approvalThreshold({userName:a,org:r,fileName:n,fromUid:o}).then((function(){t.$message({message:"已同意解密",duration:2e3,type:"success"})})).catch(console.log)},members:function(e){if(void 0==e)return[];var t=e.uidMap;if(void 0==t)return[];for(var a=[],r=0,n=Object.keys(t);r<n.length;r++){var o=n[r];a.push({name:o,value:t[o]})}return a}}},F=L,D=Object(f["a"])(F,E,M,!1,null,null,null),K=D.exports,R={name:"Organization",components:{Mine:d,Search:_,Members:j,Attributes:U,ThresholdSearch:K},watch:{$route:function(e){this.initOrg(e.params.org)}},data:function(){return{info:{},success:!1}},mounted:function(){this.initOrg(this.$route.params.org)},methods:{initOrg:function(e){var t=this;this.success=!1,void 0!=e&&v["a"].tempOrgInfo({orgName:e}).then((function(a){t.info=a,console.log(t.info),a&&"SUCCESS"===a.status&&(t.success=!0,t.getOrgDetail(e))})).catch((function(e){t.$message({message:e.message,type:"error"})}))},getOrgDetail:function(e){var t=this;v["a"].detailInfo({orgName:e}).then((function(e){t.info=Object(o["a"])(Object(o["a"])({},t.info),{},{opk:e.opk,attributes:e.attrSet})})).catch(console.log)},beforeEnter:function(e){e.dataset.index>-1&&(e.style.opacity=.5,e.style.transform="translateY(-30px)")},animEnter:function(e,t){var a=250*e.dataset.index;setTimeout((function(){e.style="",t()}),a)},animLeave:function(e,t){e.dataset.index>-1&&(e.style.opacity=.5,t())}}},B=R,J=(a("5897"),Object(f["a"])(B,r,n,!1,null,"04e6e6cb",null));t["default"]=J.exports},ae8d:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"card"},[e.title?a("div",{staticClass:"card-head"},[e._v(" "+e._s(e.title)+" "),a("div",{staticStyle:{float:"right"}},[e._t("op")],2)]):e._e(),e._t("default")],2)},n=[],o={name:"Card",props:{title:{type:String,default:""}}},s=o,i=(a("e24e"),a("52e0")),l=Object(i["a"])(s,r,n,!1,null,"88a16ad0",null);t["a"]=l.exports},e24e:function(e,t,a){"use strict";a("e826")},e826:function(e,t,a){}}]);
//# sourceMappingURL=chunk-79f17baa.dfcf3576.js.map