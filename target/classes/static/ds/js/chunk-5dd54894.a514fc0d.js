(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5dd54894"],{"0c1c":function(t,e,r){},"14d9":function(t,e,r){"use strict";var a=r("23e7"),s=r("7b0b"),o=r("07fa"),n=r("3a34"),i=r("3511"),l=r("d039"),c=l((function(){return 4294967297!==[].push.call({length:4294967296},1)})),u=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(t){return t instanceof TypeError}},m=c||!u();a({target:"Array",proto:!0,arity:1,forced:m},{push:function(t){var e=s(this),r=o(e),a=arguments.length;i(r+a);for(var l=0;l<a;l++)e[r]=arguments[l],r++;return n(e,r),r}})},"2a32":function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var a=r("b775");const s={create:function(t){const e={fileName:t.userName,t:t.threshold,n:t.usersNum,users:t.users,orgName:t.orgName};return new Promise((t,r)=>{Object(a["a"])({url:"/org/apply/creation",method:"post",data:e}).then(e=>{200===e.code?t(e.data):r(e)}).catch(r)})},join:function({userName:t,orgName:e}){const r={fileName:t,orgName:e};return new Promise((t,e)=>{Object(a["a"])({url:"/org/apply/creation/approval",method:"post",data:r}).then(r=>{200===r.code?t(r.data):e(r)}).catch(e)})},submitppk:function({orgName:t,userName:e}){const r={type:"CREATION",orgName:t,fileName:e,attrName:""};return new Promise((t,e)=>{Object(a["a"])({url:"/org/part-pk",method:"post",params:r}).then(r=>{200===r.code?t(r.data):e(r)}).catch(e)})},submitOrgAttppk:function({orgName:t,userName:e,attrName:r}){const s={type:"ATTRIBUTE",orgName:t,fileName:e,attrName:r};return new Promise((t,e)=>{Object(a["a"])({url:"/org/part-pk",method:"post",params:s}).then(r=>{200===r.code?t(r.data):e(r)}).catch(e)})},completeOrg:function({orgName:t,userName:e}){const r={type:"CREATION",orgName:t,userName:e,attrName:""};return this.complete(r)},completeOrgAttr:function({orgName:t,userName:e,attrName:r}){return this.complete({type:"ATTRIBUTE",orgName:t,userName:e,attrName:r})},complete:function({type:t,orgName:e,userName:r,attrName:s}){const o={type:t,orgName:e,fileName:r,attrName:s};return new Promise((t,e)=>{Object(a["a"])({url:"/org/complete-pk",method:"post",params:o}).then(r=>{200===r.code?t(r.data):e(r)}).catch(e)})},tempOrgInfo:function({orgName:t}){const e={type:"CREATION",orgName:t,attrName:""};return new Promise((t,r)=>{Object(a["a"])({url:"/org/apply",method:"get",params:e}).then(e=>{200===e.code?t(e.data):r(e)}).catch(t=>{t?console.log(t):r(t)})})},tempOrgAttrInfo:function({orgName:t,attrName:e}){const r={type:"ATTRIBUTE",orgName:t,attrName:e};return new Promise((t,e)=>{Object(a["a"])({url:"/org/apply",method:"get",params:r}).then(r=>{200===r.code?t(r.data):e(r)}).catch(t=>{t?console.log(t):e(t)})})},detailInfo:function({orgName:t}){const e={orgName:t};return new Promise((t,r)=>{Object(a["a"])({url:"/org/",method:"get",params:e}).then(e=>{200===e.code?t(e.data):r(e)}).catch(r)})},declareAttr:function({orgName:t,userName:e,attrName:r}){const s={orgName:t,fileName:e,attrName:r};return new Promise((t,e)=>{Object(a["a"])({url:"/org/apply/attribute",method:"post",data:s}).then(r=>{200===r.code?t(r.data):e(r)}).catch(e)})},approvalAttr:function({userName:t,orgName:e,attrName:r}){const s={fileName:t,orgName:e,attrName:r};return new Promise((t,e)=>{Object(a["a"])({url:"/org/apply/attribute/approval",method:"post",data:s}).then(r=>{200===r.code?t(r.data):e(r)}).catch(e)})}}},3511:function(t,e){var r=TypeError,a=9007199254740991;t.exports=function(t){if(t>a)throw r("Maximum allowed index exceeded");return t}},"3a34":function(t,e,r){"use strict";var a=r("83ab"),s=r("e8b5"),o=TypeError,n=Object.getOwnPropertyDescriptor,i=a&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();t.exports=i?function(t,e){if(s(t)&&!n(t,"length").writable)throw o("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e}},"44ab":function(t,e,r){"use strict";r("0c1c")},"6b79":function(t,e,r){"use strict";r.d(e,"a",(function(){return a}));const a={methods:{formatTime(t){let e="-";try{e=new Date(1e3*t);var r=e.getFullYear(),a=e.getMonth()+1,s=e.getDate(),o=e.getHours(),n=e.getMinutes(),i=e.getSeconds(),l=`${r}-${a}-${s} ${o}:${n}:${i}`;return l}catch(c){console.log(c)}return e}}}},a344:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t._self._c;return e("transition-group",{staticClass:"grid-rows",attrs:{tag:"div",appear:""},on:{"before-enter":t.beforeEnter,enter:t.animEnter,leave:t.animLeave}},[e("Mine",{key:"0",attrs:{"data-index":"0",info:t.info}}),e("Members",{key:"3",attrs:{"data-index":"0.3",info:t.info}}),t.success?[e("Attributes",{key:"5",attrs:{"data-index":"0.5",info:t.info}}),e("Search",{key:"4",attrs:{"data-index":"0.5",info:t.info}})]:t._e()],2)},s=[],o=function(){var t=this,e=t._self._c;return e("Card",{attrs:{title:"组织信息"}},[t.info?e("el-descriptions",{attrs:{column:3}},[e("el-descriptions-item",{attrs:{label:"组织名称"}},[t._v(t._s(t.info.orgId))]),e("el-descriptions-item",{attrs:{label:"成员总数"}},[t._v(t._s(t.info.n))]),e("el-descriptions-item",{attrs:{label:"阈值"}},[t._v(t._s(t.info.t))]),e("el-descriptions-item",{attrs:{label:"创建时间"}},[t._v(" "+t._s(t.formatTime(t.info.createTime))+" ")]),e("el-descriptions-item",{attrs:{label:"创建人"}},[t._v(t._s(t.info.fromUserName))]),e("el-descriptions-item",{attrs:{label:"状态"}},[t._v(t._s(t.info.status))]),t.info.opk?e("el-descriptions-item",{attrs:{label:"组织公钥"}},[t._v(t._s(t.info.opk))]):t._e()],1):t._e()],1)},n=[],i=r("ae8d"),l=r("6b79"),c={name:"Mine",mixins:[l["a"]],components:{Card:i["a"]},props:{info:{orgId:"",t:"",n:"",createTime:"",fromUserName:"",status:""}}},u=c,m=r("2877"),p=Object(m["a"])(u,o,n,!1,null,null,null),d=p.exports,f=function(){var t=this,e=t._self._c;return e("Card",{attrs:{title:"属性搜索"},scopedSlots:t._u([{key:"op",fn:function(){return[e("el-input",{attrs:{size:"medium",placeholder:"请输入要搜索的属性"},model:{value:t.newAttr,callback:function(e){t.newAttr=e},expression:"newAttr"}},[e("el-button",{attrs:{slot:"append"},on:{click:t.searchAttr},slot:"append"},[t._v("搜索")])],1)]},proxy:!0}])},[t.attr?e("div",[e("el-table",{attrs:{data:[t.attr]}},[e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"属性名",prop:"attrName"}}),e("el-table-column",{attrs:{label:"申请时间",prop:"createTime",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.formatTime(e.row.createTime))+" ")]}}],null,!1,4062287963)}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"申请人",prop:"fromUserName"}}),e("el-table-column",{attrs:{label:"状态",prop:"status",width:"150"},scopedSlots:t._u([{key:"default",fn:function(r){return[e("el-tag",{attrs:{size:"small",effect:"plain"}},[t._v(" "+t._s(r.row.status)+" ")])]}}],null,!1,2069180677)}),e("el-table-column",{attrs:{label:"操作",width:"300",align:"right"},scopedSlots:t._u([{key:"default",fn:function(r){return[e("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.submitPartPK(r.row)}}},[t._v(" 提交属性秘密 ")]),e("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.agreeAttr(r.row)}}},[t._v(" 同意 ")])]}}],null,!1,49948825)})],1),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.members(t.attr)}},[e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"name",label:"小组成员"}}),e("el-table-column",{attrs:{prop:"value",label:"是否同意该属性",align:"right"},scopedSlots:t._u([{key:"default",fn:function(r){return[e("el-tag",{attrs:{type:t.statusTypes[r.row.value]}},[t._v(" "+t._s(r.row.value?"已同意":"未响应")+" ")])]}}],null,!1,1495289878)})],1)],1):e("el-empty")],1)},g=[],h=(r("14d9"),r("07a4")),b=r("2a32"),N={name:"Search",mixins:[l["a"]],components:{Card:i["a"]},props:{info:{}},data(){return{newAttr:"",attr:!1,statusTypes:{true:"success",false:"danger"}}},methods:{searchAttr(){this.attr=!1;const t=this.info.orgId,e=`${t}:${this.newAttr}`;b["a"].tempOrgAttrInfo({orgName:t,attrName:e}).then(t=>{t?this.attr=t:this.$message({message:"没有该属性",type:"info"})}).catch(t=>{this.$message({message:t.message,type:"error"})})},submitPartPK(t){const e=h["a"].userName(),r=this.info.orgId,{attrName:a}=t;b["a"].submitOrgAttppk({userName:e,attrName:a,orgName:r}).then(()=>{this.$message({message:"提交成功",duration:2e3,type:"success"}),this.trycompleteOrgPK(e,r,a)}).catch(t=>{this.$message({message:t.message,type:"error"})})},trycompleteOrgPK(t,e,r){b["a"].completeOrgAttr({userName:t,orgName:e,attrName:r}).then(()=>{this.$message({message:"组织属性已确认创建",duration:2e3,type:"success"})}).catch(console.log)},agreeAttr(t){const e=h["a"].userName(),r=this.info.orgId,{attrName:a}=t;b["a"].approvalAttr({userName:e,orgName:r,attrName:a}).then(()=>{this.$message({message:"提交成功",duration:2e3,type:"success"})}).catch(t=>{this.$message({message:t.message,type:"error"})})},members(t){if(void 0==t)return[];const{uidMap:e}=t;if(void 0==e)return[];let r=[];for(let a of Object.keys(e))r.push({name:a,value:e[a]});return r}}},y=N,v=Object(m["a"])(y,f,g,!1,null,null,null),w=v.exports,_=function(){var t=this,e=t._self._c;return e("Card",{attrs:{title:"组织成员"}},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.members(t.info)}},[e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"name",label:"名称"}}),e("el-table-column",{attrs:{prop:"value",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(r){return[e("el-tag",{attrs:{type:t.statusTypes[r.row.value]}},[t._v(" "+t._s(r.row.value?"已接受":"未响应")+" ")])]}}])})],1)],1)},O=[],A={name:"Members",components:{Card:i["a"]},props:{info:{uidMap:{}}},data(){return{statusTypes:{true:"success",false:"danger"}}},methods:{members(t){if(void 0==t)return[];const{uidMap:e}=t;if(void 0==e)return[];let r=[];for(let a of Object.keys(e))r.push({name:a,value:e[a]});return r}}},k=A,T=Object(m["a"])(k,_,O,!1,null,null,null),x=T.exports,j=function(){var t=this,e=t._self._c;return e("Card",{attrs:{title:"组织属性"},scopedSlots:t._u([{key:"op",fn:function(){return[e("el-input",{attrs:{size:"medium",placeholder:"请输入要声明的属性"},model:{value:t.newAttr,callback:function(e){t.newAttr=e},expression:"newAttr"}},[e("el-button",{attrs:{slot:"append"},on:{click:t.generateAttr},slot:"append"},[t._v("声明新属性")])],1)]},proxy:!0}])},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.getAttributes(t.info)}},[e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"name",label:"属性名"}})],1)],1)},$=[],S={name:"Attributes",components:{Card:i["a"]},props:{info:{}},data(){return{newAttr:""}},methods:{getAttributes(t){if(void 0==t)return[];const e=t.attributes;if(void 0==e)return;let r=[];for(let a of Object.keys(e))r.push({name:e[a]});return r},generateAttr(){const t=h["a"].userName(),e=this.info.orgId,r=`${e}:${this.newAttr}`;b["a"].declareAttr({userName:t,orgName:e,attrName:r}).then(()=>{this.$message({message:"创建成功",duration:2e3,type:"success"})}).catch(t=>{this.$message({message:t.message,type:"error"})})}}},P=S,C=Object(m["a"])(P,j,$,!1,null,null,null),I=C.exports,E={name:"Organization",components:{Mine:d,Search:w,Members:x,Attributes:I},watch:{$route(t){this.initOrg(t.params.org)}},data(){return{info:{},success:!1}},mounted(){this.initOrg(this.$route.params.org)},methods:{initOrg(t){this.success=!1,void 0!=t&&b["a"].tempOrgInfo({orgName:t}).then(e=>{this.info=e,e&&"SUCCESS"===e.status&&(this.success=!0,this.getOrgDetail(t))}).catch(t=>{this.$message({message:t.message,type:"error"})})},getOrgDetail(t){b["a"].detailInfo({orgName:t}).then(t=>{this.info={...this.info,opk:t.opk,attributes:t.attrSet}}).catch(console.log)},beforeEnter:function(t){t.dataset.index>-1&&(t.style.opacity=.5,t.style.transform="translateY(-30px)")},animEnter:function(t,e){var r=250*t.dataset.index;setTimeout((function(){t.style="",e()}),r)},animLeave:function(t,e){t.dataset.index>-1&&(t.style.opacity=.5,e())}}},M=E,U=(r("44ab"),Object(m["a"])(M,a,s,!1,null,"7c05a5bf",null));e["default"]=U.exports},ae8d:function(t,e,r){"use strict";var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"card"},[t.title?e("div",{staticClass:"card-head"},[t._v(" "+t._s(t.title)+" "),e("div",{staticStyle:{float:"right"}},[t._t("op")],2)]):t._e(),t._t("default")],2)},s=[],o={name:"Card",props:{title:{type:String,default:""}}},n=o,i=(r("b581"),r("2877")),l=Object(i["a"])(n,a,s,!1,null,"88a16ad0",null);e["a"]=l.exports},b581:function(t,e,r){"use strict";r("f619")},e8b5:function(t,e,r){var a=r("c6b6");t.exports=Array.isArray||function(t){return"Array"==a(t)}},f619:function(t,e,r){}}]);
//# sourceMappingURL=chunk-5dd54894.a514fc0d.js.map